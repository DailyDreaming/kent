<HTML>
<HEAD>
	<META HTTP-EQUIV="Content-Type" CONTENT="text/html;CHARSET=iso-8859-1">
	<TITLE>Human Genome Working Draft</TITLE>
	<LINK REL="STYLESHEET" HREF="/style/HGStyle.css">
</HEAD>
<BODY BGCOLOR="FFF9D2" LINK="0000CC" VLINK="#330066" ALINK="#6600FF">
<A NAME="TOP"></A>

<TABLE BORDER=0 WIDTH="100%">
<TR><TH COLSPAN=2 ALIGN="left"><IMG SRC="/images/title.jpg"></TH></TR>

<!--HOTLINKS BAR----------------------------------------------------------->
<TR><TD COLSPAN=2 HEIGHT=40>
   <CENTER>
	<TABLE BGCOLOR="2636D1" WIDTH=100% CELLSPACING=0 CELLPADDING=0 BORDER=1 HEIGHT="22"><TR><TD>
		<TABLE WIDTH=431 CELLSPACING=4 CELLPADDING=0 BORDER=0><TR>
		<TD WIDTH=1></TD>
		<TD WIDTH=75>
			<A HREF="/index.html" onMouseOver="HOME.src='/images/hl_home.jpg'" onMouseOut="HOME.src='/images/h_home.jpg'">
			<IMG SRC="/images/h_home.jpg" ALIGN="absmiddle" BORDER="0" NAME="HOME" ALT="Home" ></A></TD>
		<TD WIDTH=155>
			<A HREF="/goldenPath/hgTracks.html" onMouseOver="BROWSER.src='/images/hl_browser.jpg'" onMouseOut="BROWSER.src='/images/h_browser.jpg'">
			<IMG SRC="/images/h_browser.jpg" ALIGN="absmiddle" BORDER="0" NAME="BROWSER" ALT="&nbsp;&nbsp; Genome Browser"></A></TD>		
		<TD WIDTH=100>
			<A HREF="/cgi-bin/hgBlat?command=start" onMouseOver="SEARCH.src='/images/hl_blat.jpg'" onMouseOut="SEARCH.src='/images/h_blat.jpg'">
			<IMG SRC="/images/h_blat.jpg" ALIGN="absmiddle" BORDER="0" NAME="SEARCH" ALT="&nbsp;&nbsp; BLAT Search"></A></TD>	
		<TD WIDTH=100>
			<A HREF="/FAQ.html" onMouseOver="GUIDE.src='/images/hl_faq.jpg'" onMouseOut="GUIDE.src='/images/h_faq.jpg'">
			<IMG SRC="/images/h_faq.jpg" ALIGN="absmiddle" BORDER="0" NAME="GUIDE" ALT="&nbsp;&nbsp; FAQ"></A></TD>
		</TR></TABLE>
	 </TR></TABLE>
	 </CENTER>
    </TD>
</TR>

<!--Content Tables------------------------------------------------------->
<TR><TD CELLPADDING=10>	
	<TABLE BGCOLOR="fffee8" WIDTH="100%" BORDERCOLOR="888888" BORDER=1><TR><TD>
	<TABLE BGCOLOR="D9E4F8" BACKGROUND="/images/hr.gif" WIDTH=100%><TR><TD>
		<FONT SIZE="4"><b>&nbsp; Procedure for Creating a Mirror Site for Human Genome Browser </b></FONT>
	</TD></TR></TABLE>
	<TABLE BGCOLOR="fffee8" WIDTH="100%" CELLPADDING=0><TR><TH HEIGHT=10></TH></TR>
	<TR><TD WIDTH=10>&nbsp;</TD><TD>

The following procedure provides you step-by-step instructions 
to create a mirror browser incrementally. You may choose to set up either 
a full mirror browser or a partial one depending on your disk space and 
needs. You are also welcome to try our <a href="#script">script</a> which 
can help you to create a mirror site on Linux system automatically.

<p><b> Prerequisites:</b>
<p> To set up a full mirror browser, we recommend at a MINIMUM the following
disk partitions and sizes:
<ul>
<li>MySQL Table spaces: ~ 50GB
<li>Apache web pages area: ~ 40GB
<li>"/gbdb" area for the browser: ~ 98GB
</ul>

<H3>WARNING! This is a major change from the previous /cluster and
 /projects based data areas.<BR>We recommend existing mirror sites closely
 check steps marked NEW ITEMS!</H3>

<br><p><a NAME="script"></a><b>Sample Automated Script:</b>
<p> We have created a script, <a href="GENOME-MIRROR.sh">GENOME-MIRROR.sh</a>,
which should automate the following steps but remains a work in progress. 
It has only been tested on Redhat Linux 7.2 systems, but you may find it useful.
<br>
	</TD><TD WIDTH=15></TD></TR></TABLE>
	<br></TD></TR></TABLE>
	
<!--START SECOND SECTION ------------------------------------------------------->
<BR>

	<TABLE BGCOLOR="fffee8" WIDTH="100%"  BORDERCOLOR="888888" BORDER=1><TR><TD>
	<TABLE BGCOLOR="D9E4F8" BACKGROUND="/images/hr.gif" WIDTH=100%><TR><TD>
		<FONT SIZE="4"><b>&nbsp;  Full Details on Steps:   </b></FONT>
	</TD></TR></TABLE>
	<TABLE BGCOLOR="fffee8" WIDTH="100%" CELLPADDING=0><TR><TH HEIGHT=10></TH></TR>
	<TR><TD WIDTH=10>&nbsp;</TD><TD>

</font>
<UL>
<LI><a href="#step1">Install Apache server and MySQL server</a>
<LI><a href="#step2">Get all the html files and most of the text files</a> (0.5 GB)
<LI><a href="#step3">Get the data for each individual genome assembly and installing databases </a>(35.1 GB)&nbsp;<B>NEW ITEMS!</B>
<LI><a href="#step4">Set up database</a>&nbsp;<B>NEW ITEMS!</B>
<LI><a href="#step5">Obtain the /gbdb data file area</a>&nbsp;<B>NEW ITEMS!</B>
<LI><a href="#step6">Get executable files</a>
<li><a href="#step7">Setup Hgcentral session preference table</a>&nbsp;<B>NEW ITEMS!</B>
<li><a href="#step8">Create a $WEBROOT/trash apache user writable directory for temp files.</a>
<li><a href="#step9">Setup HgFixed database.</a>
<li><a href="#step10">Setup Three Protein databases.</a>&nbsp;<B>NEW ITEMS!</B>
</UL>
<br><br>
<hr>
<p><a NAME="step1"></a><b>1. Install Apache server and MySQL server</b>
<ol type="a">
<li> We will not provide consulting on the operation or configuration 
	of Apache or MySQL. If you are not familiar with the setup of Apache or MySQL, 
	you will have to find someone at your site that is. We use a reference platform 
	of Redhat 7.2 for all the steps described here. <br>
<li> Find where your web pages are located. For example on a Redhat Linux
	system using a stock apache RPM, the web pages are stored in /var/www/html. 
	We will refer to this directory as WEBROOT in this document and you should 
	substitute your real path for WEBROOT where you see that in our writeup. But before
	do this, you <b>MUST</b> be aware of the following: <br>
      <ul type="DISC"><b>
      <li> THE FOLLOWING ASSUMES YOU ARE NOT ALREADY SERVING UP DATA USING YOUR 
	   APACHE SERVER. BEAR IN MIND THE SELECTION OF THE WEBROOT WILL OVERWRITE ANY 
	   EXISTING DATA IN THAT AREA.
      </ul></b>

<li> Find where your cgi-bin directory is located. It should be under
	the parent directory of the WEBROOT directory. For example on a Redhat Linux 
	system using a stock apache RPM, the path of the cgi-bin directory is 
	/var/www/cgi-bin. We will refer to this directory as CGIBIN in this document 
	and you should substitute your real path for CGIBIN where you see that.<br>
<li> Also find where your MySQL data is located. For example on a Redhat 
	Linux system using stock RPM's, this is located in /var/lib/mysql. We will 
	refer to this directory as MYSQLDATA in this document and you should substitute 
	your real path for MYSQLDATA where you see that.<br>
<br></ol>

<p><a NAME="step2"></a><b>2. Get all the html files and most of the
text files (0.5 GB)</b>
<ol type="a">
<li> Obtain the software package rsync, which if it isn't already installed on 
	your system, obtain from <a href="http://rsync.samba.org">http://rsync.samba.org</a>
<br>
<li> We are running a rsync server but you must email us first with the hostname 
	you will be rsyncing from so that we can allow it access. Email to 
	<a href="mailto:genome-mirror@cse.ucsc.edu">genome-mirror@cse.ucsc.edu</a>
<br>
<li>After we respond to your request, do a test connection: <br> 
<PRE>
rsync -navz --progress rsync://genome-rsync.cse.ucsc.edu
</PRE>
This should respond with:
<PRE>
genome          UCSC Human Genome Web Site (40 GB)
cgiscripts      UCSC Human Genome CGI Scripts (128K)
gbdb            UCSC Human Genome Browser New Config Files (68 GB)
</PRE>
<br>
<li>Determine the destination of the copy and fire off the production copy:<br>
	The trailing slash is important!<br>
<PRE>
rsync --progress -avz \
 --exclude='goldenPath/*/bigZips/*' \ 
 --exclude='goldenPath/*/chromosomes/*' \
 --exclude='goldenPath/*/database/*' \
 --exclude='goldenPath/*/contigs/*' \
 --exclude='goldenPath/*/pieces/*' \ 
 rsync://genome-rsync.cse.ucsc.edu/genome/ $WEBROOT/
</PRE>
</ol>

<p><a NAME="step3"></a><b>3. Get the data for each individual
genome assembly and installing databases ( 35.1 GB )</b>
<ul>
<p><a NAME="table"></a> Use the following table to identify the freeze 
date ($FREEZEDATE) and the database version ($DBVERSION) for each genome 
assembly:
<p>
<TABLE CELLPADDING=0 CELLSPACING=0 MARGINS=0>
<TR><TD> $FREEZEDATE </TD><TD WIDTH=10></TD><TD> $DBVERSION </TD></TR>
<TR><TD> --------------- </TD><TD></TD><TD> ---------------  </TD></TR>
<TR><TD> rnJan2003   </TD><TD></TD><TD> rn2         </TD></TR>
<TR><TD> rnNov2002   </TD><TD></TD><TD> rn1         </TD></TR>
<TR><TD> mmFeb2003   </TD><TD></TD><TD> mm3         </TD></TR>
<TR><TD> mmFeb2002   </TD><TD></TD><TD> mm2         </TD></TR>
<TR><TD> 10april2003 </TD><TD></TD><TD> hg15         </TD></TR>
<TR><TD> 14nov2002   </TD><TD></TD><TD> hg13         </TD></TR>
<TR><TD> 28jun2002   </TD><TD></TD><TD> hg12         </TD></TR>
<TR><TD> 05apr2002   </TD><TD></TD><TD> hg11         </TD></TR>
</TABLE>
</ul>
<ol type="a">

<li>Get Rat January, 2003 full data set (3.5 GB) by doing:
<p> 
<PRE>
rsync --progress -avz \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/rnJan2003/bigZips/ \
  $WEBROOT/goldenPath/rnJan2003/bigZips/
rsync --progress -avz \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/rnJan2003/chromosomes/ \
  $WEBROOT/goldenPath/rnJan2003/chromosomes/
rsync --progress -avz  \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/rnJan2003/database/ \
  $WEBROOT/goldenPath/rnJan2003/database/
</PRE>

<li>Get Rat Novemeber, 2002 full data set (3.7 GB) by doing:
<p> 
<PRE>
rsync --progress -avz \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/rnNov2002/bigZips/ \
  $WEBROOT/goldenPath/rnNov2002/bigZips/
rsync --progress -avz \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/rnNov2002/chromosomes/ \
  $WEBROOT/goldenPath/rnNov2002/chromosomes/
rsync --progress -avz  \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/rnNov2002/database/ \
  $WEBROOT/goldenPath/rnNov2002/database/
</PRE>

<li>Get Mouse February, 2003 full data set (3.6 GB) by doing:
<p> 
<PRE>
rsync --progress -avz \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/mmFeb2003/bigZips/ \
  $WEBROOT/goldenPath/mmFeb2003/bigZips/
rsync --progress -avz \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/mmFeb2003/chromosomes/ \
  $WEBROOT/goldenPath/mmFeb2003/chromosomes/
rsync --progress -avz  \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/mmFeb2003/database/ \
  $WEBROOT/goldenPath/mmFeb2003/database/
</PRE>

<li>Get Mouse February, 2002 full data set (5.5 GB) by doing:
<p> 
<PRE>
rsync --progress -avz \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/mmFeb2002/bigZips/ \
  $WEBROOT/goldenPath/mmFeb2002/bigZips/
rsync --progress -avz \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/mmFeb2002/chromosomes/ \
  $WEBROOT/goldenPath/mmFeb2002/chromosomes/
rsync --progress -avz  \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/mmFeb2002/database/ \
  $WEBROOT/goldenPath/mmFeb2002/database/
</PRE>


<li>Get Human April 10, 2003 full data set (4.3 GB) by doing:
<p> 
<PRE>
rsync --progress -avz \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/10april2003/bigZips/ \
  $WEBROOT/goldenPath/10april2003/bigZips/
rsync --progress -avz \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/10april2003/chromosomes/ \
  $WEBROOT/goldenPath/10april2003/chromosomes/
rsync --progress -avz  \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/10april2003/database/ \
  $WEBROOT/goldenPath/10april2003/database/
</PRE>

<li>Get Human November 14, 2002 full data set (8.0 GB) by doing:
<p> 
<PRE>
rsync --progress -avz \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/14nov2002/bigZips/ \
  $WEBROOT/goldenPath/14nov2002/bigZips/
rsync --progress -avz \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/14nov2002/chromosomes/ \
  $WEBROOT/goldenPath/14nov2002/chromosomes/
rsync --progress -avz  \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/14nov2002/database/ \
  $WEBROOT/goldenPath/14nov2002/database/
</PRE>

<li>Get Human June 28, 2002 full data set (7.4 GB) by doing:
<p> 
<PRE>
rsync --progress -avz \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/28jun2002/bigZips/ \
  $WEBROOT/goldenPath/28jun2002/bigZips/
rsync --progress -avz \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/28jun2002/chromosomes/ \
  $WEBROOT/goldenPath/28jun2002/chromosomes/
rsync --progress -avz  \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/28jun2002/database/ \
  $WEBROOT/goldenPath/28jun2002/database/
</PRE>

<li>Get Human April 5, 2002 full data set (4.1 GB) by doing:
<p> 
<PRE>
rsync --progress -avz \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/05apr2002/bigZips/ \
  $WEBROOT/goldenPath/05apr2002/bigZips/
rsync --progress -avz \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/05apr2002/chromosomes/ \
  $WEBROOT/goldenPath/05apr2002/chromosomes/
rsync --progress -avz  \
  rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/05apr2002/database/ \
  $WEBROOT/goldenPath/05apr2002/database/
</PRE>

<h4><a NAME="step4"></a>4. Set up database</h4>
<B>Existing Mirror Sites. There are numerous changes to tables
and data within these tables to support the /gbdb file storage method.
You are advised to consider dropping and rebuilding the databases.
If that presents a problem, contact us and we can provide detailed
updates to be made, but that is not directly documented.
</B>
<ol type="a">
<li>After connecting to the MySQL server, create a database called "$DBVERSION"
corresponding to $FREEZEDATE in the <a href="#table">table</a> above.
<PRE>
mysql> create database $DBVERSION;
</PRE>
<li>Create tables for the "$DBVERSION" database.
<ul type="i">
<li> Move to $WEBROOT/goldenPath/$FREEZEDATE/database/ directory.<BR>
All the files for creating the "$DBVERSION" database are in this directory.
<li>Create tables: (You may have to use the following shell script for this step.)
<PRE>
for file in *.sql 
do
mysql -youraccountoptions $DBVERSION < $file
done 
</PRE>
<li>Load data into the tables: (You may have to use the following 
shell script for this step.)
<PRE>
for file in *.txt.gz 
do
gunzip $file
mysqlimport -youraccountoptions $DBVERSION $file
done
</PRE>
</ul>

<li>Issue permission to the "$DBVERSION" database.<br>
Permission could be issued as follows: <br>
<PRE>
mysql> grant select on $DBVERSION.* to $USERNAME@$HOSTNAME identified by "$PASSWORD";
</PRE>
<br>
To make this command work, you need to set up $USERNAME,$HOSTNAME and 
$PASSWORD properly. In this example, public access to the "$DBVERSION" 
database is restricted to read-only.

</ul>

<h4><a NAME="step5"></a>5. Obtain the /gbdb data file area</h4>

<li>You will need the portions of /gbdb used by the browser (98 GB):
<br>
<PRE>
rsync --progress -avz \
   rsync://genome-rsync.cse.ucsc.edu/gbdb/ \
   /gbdb/
</PRE>
<br>
</ol>

<h4><a NAME="step6"></a>6. Get executable files</h4>
<ol type="a">
<li>Go to the CGIBIN directory, then do the following:
<PRE>
rsync -av rsync://genome-rsync.cse.ucsc.edu/cgiscripts/ $CGIBIN/
</PRE>

<li>In the CGIBIN directory, make a <a href="sample.html">hg.conf</a> file, in which, $USERNAME,$HOSTNAME and $PASSWORD used for the "$DBVERSION" database should be specified. Remember, variables should not be used in this file. 
<br>

<li>Set up environment variables needed by the Makefile to install the binaries for the website in the correct place.
<PRE>
setenv GLOBAL_CONFIG_FILE $CGIBIN/hg.conf
setenv HGCGI $CGIBIN
</PRE>
<li>Download the released zipped version of the source files from <a href="/admin/jksrc.zip">here</A>.
<br>
Follow the <a href="jk-install.html">instructions</a> for how to compile
the files.
</ol>

<B>Existing Mirror Sites: Note the Schema for Hgcentral Has Changed.
You are advised to drop the hgcentral database and reload it.
This will result in the loss of user settings. If this is a problem
contact us for a incremental fix.
</B>
<P>

<h4><a NAME="step7"></a>7. Setup the "hgcentral" tables </h4>
<ol type="a">
<li>Download the schema for the hgcentral database <a href="hgcentral.sql"> here</a>.
<li>Create a hgcentral database <P>
<PRE>
   mysql> create database hgcentral
</PRE>
<P>
<li>Add the hgcentral tables <P>
<PRE>
   mysql -youraccountoptions hgcentral < hgcentral.sql
</PRE>
<li>Create a user/password with the ability to update and insert. Many folks
 start out with the same user that they use for reading browser databases
 and then later create a separate user with higher priviledge. However, to
 get started, consider trying the same user.
<li>Add that user to the hg.conf. A sample hg.conf is below:
<PRE>
# Config file for the UCSC Human Genome server
#
# the format is in the form of name/value pairs
# written 'name=value' (note that there is no space between
# the name and its value. Also, no blank lines should be in
# this file
###########################################################
# db.host is the name of the MySQL host to connect to
db.host=localhost
# db.user is the username is use when connecting to the host
db.user=myhguser
# this is the password to use with the above hostname
db.password=myhguserpassword
db.trackDb=trackDb

# central.host is the name of the host of the central MySQL
# database where stuff common to all versions of the genome
# and the user database is stored.
central.db=hgcentral
central.host=localhost
#
# Be sure this user has UPDATE AND INSERT privs for hgcentral
#
central.user=myhguser
central.password=myhguserpassword
central.domain=.mydomain.edu
</PRE>
</ol>

<h4><a NAME="step8"></a>8. Create a "trash" directory </h4>
The cgi programs use a temporary area to create and store images
used by the browser. This directory is by default looked for in
$WEBROOT/trash. You should make this directory and allow the user
that runs the web server write access to it.

<h4><a NAME="step9"></a>9. Create the hgFixed database</h4>
<ol type="a">
<li>Download a copy of the dumped hgFixed tables.</li>
<PRE>
rsync --progress -avz \
   rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/hgFixed/ \
   $WEBROOT/goldenPath/hgFixed/database/
<li>Create a hgFixed database</li>
<PRE>
mysql> create database hgFixed
</PRE>
<li>Import the data in a similar fashion as listed above.</li>
</ol>
<p>
<h4><a NAME="step10"></a>10. Create the five protein databases</h4>
<ol type="a"> 
<li>Download a copy of the dumped protein tables.
<PRE>
rsync --progress -avz  \
rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/proteins/ \
$WEBROOT/goldenPath/proteins/database/
rsync --progress -avz  \
rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/proteins0111/ \
$WEBROOT/goldenPath/proteins0111/database/
rsync --progress -avz  \
rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/proteins1129/ \
$WEBROOT/goldenPath/proteins1129/database/
rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/proteins0305/ \
$WEBROOT/goldenPath/proteins0305/database/
rsync://genome-rsync.cse.ucsc.edu/genome/goldenPath/proteins0405/ \
$WEBROOT/goldenPath/proteins0405/database/
</PRE>
<li>Create the protein databases
<PRE>
mysql> create database proteins
mysql> create database proteins0111
mysql> create database proteins1129
mysql> create database proteins0305
mysql> create database proteins0405
</PRE>
<li>Import the data in a similar fashion as listed above.
</ol>
<hr WIDTH="100%">
<br><i>Should you have any comments, inquires or questions, please contact
<a href="mailto:genome-mirror@cse.ucsc.edu">genome-mirror@cse.ucsc.edu</a></i>.
<br><i>Last Modified: May 2, 2003</i>
<br>
	
	</TD><TD WIDTH=15></TD></TR></TABLE>
	<br></TD></TR></TABLE>
<!-- END SECOND SECTION ---------------------------------------------------------->

</TD></TR></TABLE>
</BODY></HTML>
