#!/usr/local/bin/perl
# File: getStsId
# Author: Terry Furey
# Date: 10/2001
# Description:  Translates dbSTS ids into STS ids

# $Id: getStsId,v 1.1 2006/09/09 21:53:59 hiram Exp $

# Usage message
if ($#ARGV < 1) {
  print stderr "USAGE: getStsId [-mouse -rat] <stsInfo.bed> <file>\n";
  exit(1);
}

# Read parameters
$mouse = 0;
$rat = 0;
while ($#ARGV > 1) {
  $param = shift(@ARGV);
  if ($param eq "-mouse") {
    $mouse = 1;
  } elsif ($param eq "-rat") {
    $rat = 1;
  } else {
    print stderr "$param is not a valid parameter\n";
  }
}
$info = shift(@ARGV);
open(INFO, "<$info") || die("Could not open $info\n");
$file = shift(@ARGV);
open(FILE, "<$file") || die("Could not open $file\n");

# Read in info file
while ($line = <INFO>) {
  chomp($line);
  @fields = split("\t",$line);
  if ($mouse) {
    $id = $fields[3];
    $probe = $fields[2];
    $id =~ s/MGI://;
    $probe =~ s/MGI://;
    $id{$probe} = $id;
  } elsif ($rat) {
    $id = $fields[0];
    $id{$id} = $fields[0];
  } else {
    $id = $fields[0];
    $dbsts = $fields[8];
    $id{$dbsts} = $id;
  }
}
close(INFO);

# Translate other file
while ($line = <FILE>) {
  chomp($line);
  ($chr, $start, $end, $id, $cov, $pctid, $acc) = split("\t",$line);
  if ($mouse) {
    $oid = $id;
  } elsif ($rat) {
    ($oid, $name) = split("_",$id);
  } else {
    ($db, $oid) = split("_",$id);
  }
  if ($id{$oid}) {
    print "$chr\t$start\t$end\t$id{$oid}\t$cov\t$pctid\t$acc\n";
  } else {
    print stderr "No id for $id\n";
  }
}
close(FILE);
