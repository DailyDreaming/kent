#!/bin/tcsh

#wget -O 1705.html "http://www.informatics.jax.org/searches/image.cgi?1705"
#grep "fetch_pixels.cgi" 1705.html | sed -e 's/.*?id=//' | sed -e 's/">.*//'

if ("$1" == "") then
    echo "error: no image id specified"
    exit 1
endif
set imageid = "$1"
set URL = "http://www.informatics.jax.org/searches/image.cgi?$imageid"
echo "imageURL=$URL"
set imagepath = /cluster/panasas/home/store/galt/jacksonLab/$imageid.html
wget -q -O $imagepath "$URL"
set hits = `grep "fetch_pixels" $imagepath | wc -l`
if ("$hits" != "1") then
    echo "error hits=$hits"
    echo "$imageid\t$hits" >> images.problems
    exit 2
endif    

set pixid = `grep "fetch_pixels.cgi" $imagepath | sed -e 's/.*?id=//' | sed -e 's/">.*//'`
#echo "pixid=$pixid"
echo "$imageid\t$pixid" >> image-pix-map.tab

#get the actual picture
set URL = "http://www.informatics.jax.org/pix/fetch_pixels.cgi?id=$pixid"
echo "pixURL=$URL"
wget -q -O /cluster/panasas/home/store/galt/jacksonLab/$pixid.jpg "$URL"

#cleanup
#rm $imagepath

