#----------------------------------
# JACKSON LABS Sybase database mgd
#----------------------------------
# 2005-06-15 (galt)

# Scripts are currently in /cluster/home/galt/jackson

# These scripts end up calling utility script query
#  which handles using sqsh utility (sql-shell) from sqsh.org.
#  sqsh was compiled --with-static and placed in /cluster/bin/i386/
#  it uses freetds from freetds.org for free libraries to connect 
#  to sybase.  sqsh also requires this in your home directory:
#[hgwdev:~> cat .freetds.conf
#[global]
#        host = gondor.informatics.jax.org
#	        port = 4025
#
#  The freebcp (bulk copy) utility which comes with freetds is 
#  used to dump all the rows from sybase - unfortunately
#  freebcp does not have a static-compile option handy.

# make database jackson on dev
hgsql hg17 -e "create database jackson"

# Transferring table structure and data from jackson
#  this calls gettable
getAllTables

# Transferring Index keys from jackson
#  this calls getindex
getAllIndexes

# Transerring images from jackson
#  this calls getimage
getAllImages
#  creates images-pix-map.tab which maps pixid to imageid 
#   and images.problems which show possible problems, 
#   but I checked them and these are just "images" that 
#   dont have a "pix".  Verify with image.cgi?$imageid
# Currently these images are saved to /cluster/panasas/home/store/galt/jacksonLab/
#   later split up into subdirs /1000 ... /8000 because too many files in one dir.
#
# Jim has since discovered pixid/imageid relationship! Great!
#> mysql> select accID,_Object_key from ACC_Accession where
#> accID="PIX:5908";
#> +----------+-------------+
#> | accID    | _Object_key |
#> +----------+-------------+
#> | PIX:5908 |        8576 |
#> +----------+-------------+
#
# hgwdev:~jackson>hgsql jackson -BN -e 'select count(*) from ACC_Accession where prefixPart = "PIX:"'
# 7997
#

# Of course the data is live and they get new stuff deposited every week,
#  we don't at this time have a live update process but each table in jackson
#  has columns created and modified that are date-time.  We can use this
#  for an incremental db update.
#


