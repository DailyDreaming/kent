#!/bin/csh -f
exit

# NHGRI DNAse I Hypersensitive sites (2004-10-15 kate)
# Data from Greg Crawford <crawford@mail.nih.gov> at the Collins Lab

cd /cluster/data/encode/NHGRI

set data = lab/DNaseI_HS_NHGRI_ENCODE2.txt
sed '/^track/d' $data > DNAseHS.bed
hgLoadBed hg16 encode_NHGRI_DNAseHS DNAseHS.bed


# Stanford Promoters from Rick Myers lab (2004-10-17 kate)

/cluster/data/encode/StanfordPromoters
mkdir StanfordPromoters_20040825
ln -s latest StanfordPromoters_20040825
cd latest

csh makePromoterFiles.csh > promoterExps.tab
wc -l promoterExps.exp
    # 14

# currently hgTracks only looks in hgFixed for the experiment table
#  (add a trackDb option)
hgExperiment hgFixed encode_Stanford_Promoters \
                promoterExps.tab promoterPos.bed promoterData.tab
hgLoadBed hg16 encode_Stanford_Promoters encode_Stanford_Promoters.tab


# Dutta lab (Univ. Virginia) replication data (2004-10-22 kate)
#       Submitted as custom track, coords on hg15

cd /cluster/data/encode/UVa
# data (was MS-WORD)
dos2unix lab/Dutta_Rep_profile.txt
# documentation (ditto)
dos2unix lab/UCSC-_data_release.txt

# split file of customtracks into multiple files
./splitCustomTracks.pl lab/Dutta_Rep_profile.txt repl
wc -l *.?-?{,?}
    # 163 repl.0-2
    # 301 repl.2-4
    # 296 repl.4-6
    # 523 repl.6-8
    # 421 repl.8-10
    # 1704 total

wc -l lab/Dutta_Rep_profile.txt
  # 1704 lab/Dutta_Rep_profile.txt

cat > checkEncodeTable.csh << 'EOF'
hgsql hg16 -N -s -e "SELECT er.name, count(*) FROM encodeRegions er, $1 hs WHERE er.chrom=hs.chrom AND hs.chromStart between er.chromStart AND er.chromEnd group by er.name"
'EOF'

# load w/o binning to maintain ordering by chromStart
foreach f (repl.?-?{,?})
    liftOver $f /cluster/data/hg15/bed/liftOver/hg15ToHg16.over.chain \
                $f.hg16.bed $f.unmapped
    set time = `echo $f:e | sed 's/-/_/'`
    hgLoadBed -noBin hg16 encode_UVA_DNARep_$time $f.hg16.bed
    csh checkEncodeTable.csh encode_UVA_DNARep_$time > $time.ct
end
wc -l *.hg16.bed
    # 160 repl.0-2.hg16.bed
    # 298 repl.2-4.hg16.bed
    # 294 repl.4-6.hg16.bed
    # 520 repl.6-8.hg16.bed
    # 416 repl.8-10.hg16.bed
   # 1688 total
wc -l *.unmapped
      # 0 repl.0-2.unmapped
      # 0 repl.2-4.unmapped
      # 0 repl.4-6.unmapped
      # 0 repl.6-8.unmapped
      # 0 repl.8-10.unmapped
      # 0 total
cut -f 1 *.ct | sort | uniq > regions
wc -l regions
 # 43 regions (1 missing)
hgsql  hg16 -N -s -e "SELECT name from encodeRegions" | sort | diff - regions 


# UC San Diego ChIP/Chip data (Bing Ren's Lab) (2004-09-30 kate)
# Provided by Chunxu Qu [mailto:qchunxu@ucsd.edu] on Oct. 1, 2004

# Unpack data and rename files 

ssh kksilo
cd /cluster/data/encode
mkdir -p UCSD/project1
cd UCSD/project1
gunzip project1.tar.gz
foreach f (*.wig)
    mv $f $f.bed
end

# consists of 8 custom track wiggle BED files

ssh hgwdev
mkdir /gbdb/hg16/encode/UCSD_ChIP/wib
cd /cluster/data/encode/UCSD/project1
mkdir wig
cd wig
cat > makeWig.csh << 'EOF'
foreach f (../*.bed)
    # get base name
    set b = $f:t:r:r
    # strip non-informative parts of name
    set n = `echo $b | sed -e 's/ave_//' -e 's/_p//' | tr '[a-z]' '[A-Z]'`
    echo $n
    # create wiggle data files from BED
    sed -e '/^browser/d' -e '/^track/d' $f | \
        wigBedToBinary stdin $n.wig $n.wib
    ln -s `pwd`/$n.wib /gbdb/hg16/encode/UCSD_ChIP/wib
    # load into database
    hgLoadWiggle hg16 encode_UCSD_ChIP_$n $n.wig \
                -pathPrefix=/gbdb/hg16/encode/UCSD_ChIP/wib
end
'EOF'
# << for emacs

csh makeWig.csh >&! makeWig.log &
# Converted stdin, upper limit 16.00, lower limit 0.00, etc.

hgsql hg16 -s -e "select count(*) from encode_UCSD_ChIP_RNAP_HELA"
    # 19571

# create entries in trackDb, default height 16 pixels
# Use Jim's suggestion to associate a color with a cell line
     # Pol2 Hela (black)
     # Pol2 THP1 (darkish blue)
     # Pol2 IMR90 (darkish red)
     # Pol2 HCT116 (darkish green)
     # TAF1 Hela (black)
     # TAF1 THP1 (darkish blue)
     # TAF1 IMR90 (darkish red)
     # TAF1 HCT116 (darkish green)




