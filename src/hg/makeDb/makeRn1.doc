# This file describes how we made the browser database on the Rattus 
# Norvegicus genome, November 2002 build.

CREATING DATABASE (DONE 11/25/02)

    # Create the database.
    ssh hgwdev
    # Enter mysql via:
    mysql -u hgcat -pbigsecret
    # At mysql prompt type:
      create database rn1;
      quit
    # make a semi-permanent read-only alias:
    alias rn1 "mysql -u hguser -phguserstuff -A rn1"
    # Use df to ake sure there is at least 5 gig free on 
    # hgwdev:/var/lib/mysql


COPY OVER JKSTUFF SCRIPTS DIRECTORY (DONE 11/25/02)

    ssh eieio
    ln -s /cluster/store4/rn1 ~/rn1
    # This is the first rat, so use mm2 as the previous "rat" build:
    ln -s /cluster/store2/mm.2002.02/mm2 ~/lastRn
    cd ~/rn1
    cp -Rp ~/lastRn/jkStuff .
    rm jkStuff/*.{out,lst,lft} jkStuff/*~


BREAK UP SEQUENCE INTO 5 MB CHUNKS AT NON_BRIDGED CONTIGS (DONE 11/25/02)

    # This version of the rat sequence data is in /cluster/store4/rn1.
    # The version of the sequence downloaded 11/25/02 is multi-record FA 
    # with AGP.  Use agpToFA to make chromosome .fa files, then use 
    # splitFaIntoContigs to make contig chromosome files.
    ssh eieio
    cd ~/rn1
    foreach c (?{,?})
      agpToFa -simpleMulti $c/chr$c.agp chr$c $c/chr$c.fa $c/chr$c.contig.fa
      if (-e $c/chr${c}.random.agp) then
        agpToFa -simpleMulti $c/chr$c.random.agp chr${c}_random \
          $c/chr${c}_random.fa $c/chr$c.random.contig.fa
      endif
    end
    # Check that the size of each chromosome .fa file is equal to the 
    # last coord of the .agp:
    foreach f ( */*.agp )
      set agpLen = `tail -1 $f | awk '{print $3;}'`
      set g = `echo $f:r | sed -e 's/\.random/_random/'`
      set faLen = `faSize $g.fa | awk '{print $1;}'`
      if ($agpLen == $faLen) then
        echo $f length = $g length = $faLen
      else
        echo Error\!\!\!  $f length = $agpLen, but $g length = $faLen
      endif
    end

    ssh hgwdev
    cd into your CVS source tree under kent/src/hg/splitFaIntoContigs
    make

    # This will split the rat sequence into approx. 5 Mbase
    # supercontigs between non-bridged clone contigs and drop the
    # resulting dir structure in /cluster/store4/rn1.  The resulting
    # dir structure will include 1 dir for each chromosome, each of
    # which has a set of subdirectories, one subdir per supercontig.
    ssh eieio
    cd ~/rn1
    foreach c (?{,?})
      cp -p $c/chr$c.agp $c/chr$c.agp.bak
      cp -p $c/chr$c.fa $c/chr$c.fa.bak
      splitFaIntoContigs $c/chr$c.agp $c/chr$c.fa . -nSize=5000000
      if (-e $c/chr${c}_random.fa) then
        cp -p $c/chr$c.random.agp $c/chr$c.random.agp.bak
        cp -p $c/chr${c}_random.fa $c/chr${c}_random.fa.bak
        splitFaIntoContigs $c/chr$c.random.agp $c/chr${c}_random.fa . \
          -nSize=5000000
        mv ${c}_random/lift/oOut.lst $c/lift/rOut.lst
        mv ${c}_random/lift/ordered.lft $c/lift/random.lft
        mv ${c}_random/lift/ordered.lst $c/lift/random.lst
        rmdir ${c}_random/lift
        rm ${c}_random/chr${c}_random.{agp,fa}
        mv ${c}_random/* $c
        rmdir ${c}_random
      endif
    end
    # Make sure the reconstructed .fa jives with the original:
    foreach f ( */*.fa.bak )
      echo $f:r
      diff $f $f:r | wc -l
    end
    # The .agp goes through a slight format change, but make sure it 
    # at least ends up with the same number of lines:
    foreach f ( */*.agp.bak )
      set l1 = `wc -l $f | awk '{print $1;}'`
      set l2 = `wc -l $f:r | awk '{print $1;}'`
      if ($l1 == $l2) then
        echo "$f and $f:r have the same #lines"
      else
        echo Error\!\!\!  $f has $l1 lines, but $f:r has $l2
      endif
    end



REPEAT MASKING (DONE 11/26/02)
   Split contigs, run RepeatMasker, lift results
   Notes: 
   * If there is a new version of RepeatMasker, build it and ask the admins 
     to binrsync it (kkstore:/scratch/hg/RepeatMasker/*).
   * Contigs (*/chr*_*/chr*_*.fa) are split into 500kb chunks to make 
     RepeatMasker runs manageable on the cluster ==> results need lifting.
   * For the NCBI assembly we repeat mask on the sensitive mode setting
     (RepeatMasker -m -s)

        #- Split contigs into 500kb chunks:
        ssh eieio
        cd ~/rn1
        foreach d ( */chr*_?{,?} )
          cd $d
          set contig = $d:t
          faSplit size $contig.fa 500000 ${contig}_ -lift=$contig.lft \
            -maxN=500000
          cd ../..
        end

        #- Make the run directory and job list:
        cd ~/rn1
        mkdir RMRun
        rm -f RMRun/RMJobs
        touch RMRun/RMJobs
        foreach d ( ?{,?}/chr*_?{,?} )
          set ctg = $d:t
          foreach f ( $d/${ctg}_?{,?}.fa )
            set f = $f:t
            echo /cluster/bin/scripts/RMRat \
                 /cluster/store4/rn1/$d $f \
               '{'check out line+ /cluster/store4/rn1/$d/$f.out'}' \
              >> RMRun/RMJobs
          end
        end

        #- Do the run
        ssh kk
        cd ~/rn1/RMRun
        para create RMJobs
        para try, para check, para check, para push, para check,...

        #- Lift up the split-contig .out's to contig-level .out's
        ssh eieio
        cd ~/rn1
        foreach d ( ?{,?}/chr*_?{,?} )
          cd $d
          set contig = $d:t
          liftUp $contig.fa.out $contig.lft warn ${contig}_*.fa.out > /dev/null
          cd ../..
        end

        #- Lift up the contig-level .out's to chr-level
        cd ~/rn1
        ./jkStuff/liftOut5.sh

	# soft-mask contig .fa's with .out's
        foreach i (?{,?})
            foreach j ($i/chr${i}_?{,?}/chr${i}_?{,?}.fa \
                       $i/chr${i}_random_?{,?}/chr${i}_random_?{,?}.fa)
                maskOutFa $j $j.out $j -soft
            end
            echo done $i
        end

        #- copy the contig .fa's to the appropriate place on /scratch
        ssh kkstore
        mkdir -p /scratch/hg/rn1/contigs.1126
        cp -p ~/rn1/?{,?}/chr*/chr?{,?}{,_random}_?{,?}.fa \
          /scratch/hg/rn1/contigs.1126

        #- Load the .out files into the database with:
        ssh hgwdev
        cd ~/rn1
        hgLoadOut rn1 ?{,?}/*.fa.out


VERIFY REPEATMASKER RESULTS (DONE 11/26/02)

    # Run featureBits on rn1 and on a comparable genome build, and compare:
    ssh hgwdev
    featureBits rn1 rmsk
    # --> 1081814344 bases of 2852382926 (37.927%) in intersection
    featureBits mm2 rmsk
    # --> 1037964664 bases of 2726995854 (38.063%) in intersection

    # Run RepeatMasker manually on a couple mini-contigs, verify that 
    # they appear in the chrom .out and are masked in the sequence file. 

    # Look at the DNA sequence of some RepeatMasker elements in the 
    # genome browser;  visually compare them to the RepeatMasker library 
    # elements and make sure an alignment is plausible.  


MAKE LIFTALL.LFT (DONE 11/26/02)

    cd ~/rn1
    cat ?{,?}/lift/{ordered,random}.lft > jkStuff/liftAll.lft


STORING O+O SEQUENCE AND ASSEMBLY INFORMATION  (DONE 11/26/02)

     # Load chromosome sequence info into database and save size info.
     ssh hgwdev
     hgsql rn1  < ~/src/hg/lib/chromInfo.sql
     cd ~/rn1
     hgNibSeq -preMadeNib rn1 /cluster/store4/rn1/nib \
       ?{,?}/chr?{,?}{,_random}.fa
     echo "select chrom,size from chromInfo" | hgsql rn1 > chrom.sizes
     # Make /gbdb/rn1/nib directory
     mkdir -p /gbdb/rn1/nib
     cd /gbdb/rn1/nib
     foreach f ( /cluster/store4/rn1/nib/chr*.nib )
       ln -s $f
     end


MAKE GCPERCENT (DONE 11/26/02)
     ssh hgwdev
     cd /cluster/store4/rn1/bed
     mkdir gcPercent
     cd gcPercent
     hgsql rn1  < ~/src/hg/lib/gcPercent.sql
     hgGcPercent rn1 ../../nib


MAKE HGCENTRALTEST ENTRY AND TRACKDB TABLE FOR RN1 (DONE 11/26/02)
    # Enter rn1 into hgcentraltest.dbDb so test browser knows about it:
    ssh genome-testdb
    mysql -u root -pbigSecret hgcentral
      insert into dbDb values("rn1", "Rat Nov. 2002",
        "/cluster/store4/rn1/nib", "Rat", "chr1:15647901-18981566", 1,
        10, "Rat");
      quit
    # Make trackDb table so browser knows what tracks to expect:
    ssh hgwdev
    cd ~/src/hg/makeDb/hgTrackDb
    cvs up -d -P
    # Edit that makefile to add rn1 in all the right places and do
    make
    make update
    cvs commit makefile


COPY GENBANK MRNA DATA TO THE CLUSTER (TODO for mrna.132)
   ssh kkstore
   # Copy the rna data to the cluster if it isn't there already:
   mkdir /scratch/hg/mrna.132
   cp -r /cluster/store2/mrna.132/org /scratch/hg/mrna.132
   # Distribute this data to the local nodes: ask sysadmins, or run:
   sudo /cluster/install/utilities/updateLocal


GOLD AND GAP TRACKS (DONE 11/26/02)
    ssh hgwdev
    cd ~/rn1
    hgGoldGapGl -noGl rn1 /cluster/store4/rn1 .


CREATE RELATIONAL MRNA DATABASE (DONE)
    ssh hgwdev
    # Make symbolic links from hgwdev's /gbdb to the real .fa locations:
    mkdir -p /gbdb/rn1/mrna.132
    cd /gbdb/rn1/mrna.132
    ln -s /cluster/store2/mrna.132/org/Rattus_norvegicus/mrna.fa
    ln -s /cluster/store2/mrna.132/org/Rattus_norvegicus/est.fa
    ln -s /cluster/store1/refSeqCum/112602/org/Rattus_norvegicus/refSeq.fa
    # Call hgLoadRna with the /gbdb locations:
    cd /cluster/store2/temp
    hgLoadRna new rn1

    mkdir /cluster/store2/mrna.132
    cd /cluster/store2/mrna.132

Make the anyRna.fil file using this text:

restrict mol=mRNA
hide mol

# Make the RNAs
        gunzip -c /cluster/store2/genbank.132/gb{pri,rod,v,mam,inv,bct,htc,pat,phg,pln}* \
        | gbToFaRa -byOrganism=org anyRna.fil mrna.fa mrna.ra mrna.ta stdin

# Make the ESTs
        gunzip -c /cluster/store2/genbank.132/gbest*.gz | \
        gbToFaRa anyRna.fil est.fa est.ra est.ta stdin -byOrganism=org

    mkdir -p /gbdb/rn1/mrna.132
    cd /gbdb/rn1/mrna.132
    ln -s /cluster/store2/mrna.132/org/Rattus_norvegicus/mrna.fa /gbdb/rn1/mrna.132/mrna.fa
    ln -s /cluster/store2/mrna.132/org/Rattus_norvegicus/mrna.ra /gbdb/rn1/mrna.132/mrna.ra
    ln -s /cluster/store2/mrna.132/org/Rattus_norvegicus/est.fa /gbdb/rn1/mrna.132/est.fa
    ln -s /cluster/store2/mrna.132/org/Rattus_norvegicus/est.ra /gbdb/rn1/mrna.132/est.ra
    ln -s /cluster/store1/refSeqCum/112602/org/Rattus_norvegicus/refSeq.fa /gbdb/rn1/mrna.132/refSeq.fa
    ln -s /cluster/store1/refSeqCum/112602/org/Rattus_norvegicus/refSeq.ra /gbdb/rn1/mrna.132/refSeq.ra

    cd /cluster/store2/temp
    hgLoadRna add -type=mRNA rn1 /gbdb/rn1/mrna.132/mrna.fa /gbdb/rn1/mrna.132/mrna.ra
    hgLoadRna add -type=EST rn1 /gbdb/rn1/mrna.132/est.fa /gbdb/rn1/mrna.132/est.ra

MAKING AND STORING mRNA AND EST ALIGNMENTS  (TODO) DONE FOR ALL REFSEQ STEPS


    # Use BLAT to generate refSeq, mRNA and EST alignments as so:
    #  Make sure that /scratch/hg/rn1/contigs is loaded
    #  with chr*_*.fa and pushed to the cluster nodes.  
    ssh kk
    cd ~/rn1/bed
    foreach i (refSeq mrna est) # DONE FOR REFSEQ
      mkdir -p $i
      cd $i
      ls -1S /scratch/hg/rn1/contigs.1126/* > genome.lst
      ls -1 /scratch/hg/mrna.132/Rattus_norvegicus/$i.fa > mrna.lst
      cp ~/mm2/bed/$i/gsub .
      mkdir psl
      gensub2 genome.lst mrna.lst gsub spec
      cd ..
    end 

    # check on progress with para check in mrna, est, and refSeq directories.
    # report on runtime when finished:
      para create spec
      para try
      para push
    para time > time

      
    # Process refSeq, mRNA, and EST alignments into near best in genome.
    ssh eieio - DONE FOR REFSEQ
    cd ~/rn1/bed
    cd refSeq
    pslSort dirs raw.psl /cluster/store2/temp psl
    pslReps -minCover=0.2 -sizeMatters -minAli=0.98 -nearTop=0.002 raw.psl \
      contig.psl /dev/null
    liftUp -nohead all_refSeq.psl ../../jkStuff/liftAll.lft warn contig.psl
    pslSortAcc nohead chrom /cluster/store2/temp all_refSeq.psl
    cd ..

    cd mrna
    pslSort dirs raw.psl /cluster/store2/temp psl
    pslReps -minAli=0.98 -sizeMatters -nearTop=0.005 raw.psl contig.psl \
      /dev/null
    liftUp -nohead all_mrna.psl ../../jkStuff/liftAll.lft warn contig.psl
    pslSortAcc nohead chrom /cluster/store2/temp all_mrna.psl
    cd ..

    cd est
    pslSort dirs raw.psl /cluster/store2/temp psl
    pslReps -minAli=0.98 -sizeMatters -nearTop=0.005 raw.psl contig.psl \
      /dev/null
    liftUp -nohead all_est.psl ../../jkStuff/liftAll.lft warn contig.psl
    pslSortAcc nohead chrom /cluster/store2/temp all_est.psl
    cd ..

    # Load mRNA alignments into database.
    ssh hgwdev
    cd /cluster/store4/rn1/bed/mrna/chrom
    foreach i (chr?{,?}{,_random}.psl)
        mv $i $i:r_mrna.psl
    end
    hgLoadPsl rn1 *.psl
    cd ..
    hgLoadPsl rn1 all_mrna.psl -nobin

    # Load EST alignments into database.
    ssh hgwdev
    cd /cluster/store4/rn1/bed/est/chrom
    foreach i (chr?{,?}{,_random}.psl)
        mv $i $i:r_est.psl
    end
    hgLoadPsl rn1 *.psl
    cd ..
    hgLoadPsl rn1 all_est.psl -nobin

    # Create subset of ESTs with introns and load into database.
    ssh eieio
    cd ~/rn1
    tcsh jkStuff/makeIntronEst.sh
    ssh hgwdev
    cd ~/rn1/bed/est/intronEst
    hgLoadPsl rn1 *.psl

    # Load refSeq alignments into database - DONE
    ssh hgwdev
    cd ~/rn1/bed/refSeq
    pslCat -dir chrom > refSeqAli.psl
    hgLoadPsl rn1 -tNameIx refSeqAli.psl


PRODUCING ESTORIENTINFO TABLE

This table is needed for proper orientation of ESTs in the
browser.  Many will appear on the wrong strand without it.
This involves a cluster run.  First load the EST psl files
as so:
     ssh eieio
     cd ~/rn1/bed/est
     pslSortAcc nohead contig /cluster/store2/temp contig.psl
     mkdir /scratch/hg/rn1/est
     cp -r contig /scratch/hg/rn1/est
     sudo /cluster/install/utilities/updateLocal
Wait for these to finish.
     cd ..
     mkdir estOrientInfo
     cd estOrientInfo
     mkdir ei
     ls -1S /scratch/hg/rn1/est/contig > psl.lst
     cp ~/lastRn/bed/estOrientInfo/gsub .
Update gsub to refer to rat contig sequence currently on
/scratch, and rat ESTs on /scratch.
     gensub2 psl.lst single gsub spec
     para create spec
Then run the  job on the cluster
     ssh kk
     cd ~/rn1/bed/estOrientInfo
     para try
     sleep 60
     para check
If things look good
     para push
Wait for this to finish then
     liftUp estOrientInfo.bed ../../jkStuff/liftAll.lft warn ei/*.tab
Load them into database as so:
     ssh hgwdev
     cd ~/rn1/bed/estOrientInfo
     hgLoadBed rn1 estOrientInfo estOrientInfo.bed -sqlTable=/cluster/home/kent/src/hg/lib/estOrientInfo.sql
     
CREATE RNACLUSTER TABLE (TODO)
 Make sure that refSeqAli and estOrientInfo tables are made already
 (see above).

   ssh hgwdev
   cd ~/rn1/bed
   mkdir rnaCluster
   cd rnaCluster
   mkdir rna est
   foreach i (1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 X Un)
       clusterRna rn1 rna/chr$i.bed est/chr$i.bed -chrom=chr$i
       echo done $i
   end
   hgLoadBed rn1 rnaCluster est/*.bed

PRODUCING KNOWN GENES (IN PROGRESS)

o - Download everything from ftp://ftp.ncbi.nih.gov/refseq/cumulative
    into /cluster/store1/refSeqCum/112602
        cd /cluster/store1/refSeqCum/112602
        uncompress rscu.gbff.Z
        Put the following lines into anyRna.fil
        restrict mol=mRNA
        hide mol        
        gbToFaRa anyRna.fil refSeq.fa refSeq.ra refSeq.ta -byOrganism=org
        This will create fasta and annotations for the rat in refSeq/org
        in refSeq.fa and refSeq.ra under the org/Rattus_norvegicus directory
o - Get extra info from NCBI and produce refGene table as so:
       wget ftp://ftp.ncbi.nih.gov/refseq/LocusLink/loc2ref 
       wget ftp://ftp.ncbi.nih.gov/refseq/LocusLink/mim2loc

o -   hgLoadRna add -type=refSeq rn1 /gbdb/rn1/mrna.132/refSeq.fa /gbdb/rn1/mrna.132/refSeq.ra

o - Produce refGene, refPep, refMrna, and refLink tables as so:
Get the rat proteins:
        wget ftp://ftp.ncbi.nih.gov/refseq/R_norvegicus/mRNA_Prot/rat.faa.gz
        gunzip rat.faa.gz
        cd ~/rn1/bed/refSeq
       hgRefSeqMrna rn1 /cluster/store1/refSeqCum/112602/org/Rattus_norvegicus/refSeq.fa \
        /cluster/store1/refSeqCum/112602/org/Rattus_norvegicus/refSeq.ra \
        all_refSeq.psl /cluster/store1/refSeqCum/112602/loc2ref \
        /cluster/store1/refSeqCum/112602/rat.faa \
        /cluster/store1/refSeqCum/112602/mim2loc
o - Add RefSeq status info 
    hgRefSeqStatus rn1 /cluster/store1/refSeqCum/112602/loc2ref

REFFLAT - DONE

o - create precomputed join of refFlat and refGene:
      echo 'CREATE TABLE refFlat (KEY geneName (geneName), KEY name (name), KEY chrom (chrom)) SELECT refLink.name as geneName, refGene.* FROM refLink,refGene WHERE refLink.mrnaAcc = refGene.name' | hgsql rn1


SIMPLE REPEAT TRACK (DONE* 11/26/02)
 * 18 of the 590 contigs were re-run with TRF version 2 (trf.2) due to 
   crash/hang problems with TRF v3.01 (trf).  

    ssh kk
    mkdir ~/rn1/bed/simpleRepeat
    cd ~/rn1/bed/simpleRepeat
    cp ~/lastRn/bed/simpleRepeat/gsub .
    mkdir trf
    ls -1 /scratch/hg/rn1/contigs.1126/*.fa > genome.lst
    touch single
    gensub2 genome.lst single gsub spec
    para create spec
    para try
    para push 
    # When job is done do:
    liftUp simpleRepeat.bed ~/rn1/jkStuff/liftAll.lft warn trf/*.bed

    # Load this into the database as so
    ssh hgwdev
    cd ~/rn1/bed/simpleRepeat
    hgLoadBed rn1 simpleRepeat simpleRepeat.bed \
      -sqlTable=$HOME/src/hg/lib/simpleRepeat.sql


PREPARING SEQUENCE FOR CROSS SPECIES ALIGNMENTS (DONE 11/27/02)

    # After the simpleRepeats track has been built, make a filtered version 
    # of the trf output: keep trf's with period <= 12:
    ssh eieio
    cd ~/rn1/bed/simpleRepeat
    mkdir -p trfMask
    foreach f (trf/chr*.bed)
      awk '{if ($5 <= 12) print;}' $f > trfMask/$f:t
    end
    # Lift up filtered trf output to chrom coords as well:
    cd ~/rn1
    mkdir -p bed/simpleRepeat/trfMaskChrom
    foreach c (?{,?})
      perl -wpe 's@(\S+)@bed/simpleRepeat/trfMask/$1.bed@' \
        $c/lift/ordered.lst > $c/lift/oTrf.lst
      if (-e $c/lift/random.lst) then
        perl -wpe 's@(\S+)@bed/simpleRepeat/trfMask/$1.bed@' \
           $c/lift/random.lst > $c/lift/rTrf.lst
      endif
      liftUp bed/simpleRepeat/trfMaskChrom/chr$c.bed \
        jkStuff/liftAll.lft warn `cat $c/lift/oTrf.lst`
      if (-e $c/lift/rTrf.lst) then
        liftUp bed/simpleRepeat/trfMaskChrom/chr${c}_random.bed \
          jkStuff/liftAll.lft warn `cat $c/lift/rTrf.lst`
      endif
    end
    # Make a trfMasked version of the contigs:
    cd ~/rn1
    mkdir trfFa
    foreach f (?{,?}/chr*/chr?{,?}{,_random}_?{,?}.fa)
      set c = $f:t:r
      maskOutFa -softAdd $f bed/simpleRepeat/trfMask/$c.bed trfFa/$c.fa.trf
    end
    # Then make sure there is enough space available on /scratch and do
    ssh kkstore
    cp -Rp ~/rn1/trfFa /scratch/hg/rn1/trfFa.1127
    # ask for binrsync, or sudo /cluster/install/utilities/updateLocal


MAKE DOWNLOADABLE SEQUENCE FILES (IN PROGRESS)

    # This used to be done right after RepeatMasking.  Now, we mask with 
    # TRF as well, so do this after the "PREPARING SEQUENCE" step above.
    ssh eieio
    cd ~/rn1
    #- Soft-mask (lower-case) the contig and chr .fa's
    ./jkStuff/makeFaMasked.sh
    #- Make hard-masked .fa.masked files as well:
    ./jkStuff/makeHardMasked.sh
    #- Rebuild the nib, mixedNib, maskedNib files:
    ./jkStuff/makeNib.sh
    #- Rebuild the .zip files
    ./jkStuff/zipAll.sh

    #- Copy the .zip files to hgwdev:/usr/local/apache/...
    ssh hgwdev
    cd ~/rn1
    ./jkStuff/cpToWeb.sh


PRODUCING GENSCAN PREDICTIONS (TODO)
    
o - Produce contig genscan.gtf genscan.pep and genscanExtra.bed files like so:

        First make sure you have appropriate set up, permissions, etc.
        and you have tried using Parasol to submit and finished a set 
        of jobs successfully.
        
        Load up the cluster with hard-masked contigs in
           /scratch/hg/rn1/mContigs
             
        Log into kkr1u00 (not kk!).  kkr1u00 is the driver node for the small
        cluster (kkr2u00 -kkr8u00. (genscan has problem running on the
        big cluster, due to limitation of memory and swap space on each
        processing node).
                     cd ~/rn1
                     cd bed/genscan
        Make 3 subdirectories for genscan to put their output files in
                mkdir gtf pep subopt
        Generate a list file, genome.list, of all the contigs
                ls -1S /cluster/store4/rn1/mContigs/* >genome.list
        Edit genome.list to remove jobs on all 20 files of chr??_1.fa.masked.
        Those files have pure Ns due to heterochromatin (unsequencable
        stuff) and will cause genscan to run forever.
        
        Create template file, gsub, for gensub2.  For example (3 lines file):
                #LOOP
                /cluster/home/fanhsu/bin/i386/gsBig {check in line+ $(path1)} {check out line gtf/$(root1).gtf} -trans={check out line pep/$(root1).pep} -subopt={check out line subopt/$(root1).bed} -exe=/cluster/home/fanhsu/projects/compbio/bin/genscan-linux/genscan -par=/cluster/home/fanhsu/projects/compbio/bin/genscan-linux/HumanIso.smat -tmp=/tmp -window=2400000
                #ENDLOOP
        Create a file containing a single line.
                echo single > single
        Generate job list file, jobList, for Parasol
                gensub2 genome.list single gsub jobList
        
        Edit jobList to find the line containing "chr12_5.fa.masked"
        and change "-window=2400000" into "-window=1200000", because
        genscan has "not enough memory" problem with this particular
        file.
        
        First issue the following Parasol command:
                para create jobList
        Run the following command, which will try first 10 jobs from jobList
                para try
        Check if these 10 jobs run OK by
                para check
        If they have problems, debug and fix your program, template file, 
        commands, etc. and try again.  If they are OK, then issue the following 
        command, which will ask Parasol to start all the remaining jobs (around
        ~252 jobs).
                para push
        Issue either one of the following two commands to check the 
        status of the cluster and your jobs, until they are done.
                parasol status
                para check
        If any job fails to complete, study the problem and ask Jim to help
        if necessary.

o - Convert these to chromosome level files as so:
     cd ~/rn1
     cd bed/genscan
     liftUp genscan.gtf ../../jkStuff/liftAll.lft warn gtf/*.gtf
     liftUp genscanSubopt.bed ../../jkStuff/liftAll.lft warn subopt/*.bed
     cat pep/*.pep > genscan.pep

o - Load into the database as so:
     ssh hgwdev
     cd ~/rn1/bed/genscan
     ldHgGene rn1 genscan genscan.gtf
     hgPepPred rn1 generic genscanPep genscan.pep
     hgLoadBed rn1 genscanSubopt genscanSubopt.bed


EXTRACT LINEAGE-SPECIFIC REPEATS (ARIAN SMIT''s scripts) (TODO)

    ssh eieio
    mkdir -p ~/rn1/bed/linSpecRep
    cd ~/rn1/bed/linSpecRep
    foreach f (~/rn1/*/*.out)
        ln -sf $f .
    end
    /cluster/bin/scripts/rodentSpecificRepeats.pl *.out
    /cluster/bin/scripts/perl-rename 's/(\.fa|\.nib)//' *.out.*spec
    /cluster/bin/scripts/perl-rename 's/\.(rod|prim)spec/.spec/' *.out.*spec
    rm *.out
    rm -rf /scratch/hg/rn1/linSpecRep
    cd ..
    cp -R linSpecRep /scratch/hg/rn1
    # Ask cluster-admin@cse.ucsc.edu to binrsync /scratch/hg to clusters


MAKING THE BLASTZBESTRAT TRACK FROM PENN STATE AXT FILES (TODO)
    # When Scott Schwartz is done generating .axt's for the blastz 
    # alignments...

    # Create tSizes (human chrom size) and qSizes (rat) for axtToPsl.
      ssh hgwdev
      cd /cluster/store1/gs.13/build30/blastz.rn1gs13.2002-08-30
      In mysql:
         use rn1
         select chrom,size from chromInfo;
         use hg12
         select chrom,size from chromInfo;
      Edit the results of the first select into a tab-separated tSizes,
      edit the results of the second select into a tab-separated qSizes.

    # Consolidate AXT files to chrom level, sort, pick best, make psl.
    ssh eieio
    set base="/cluster/store1/gs.13/build30/blastz.rn1gs13.2002-08-30"
    set tbl="blastzBestHuman_08_30"
    cd $base
    mkdir -p axtBest pslBest
    foreach f (run.2/chr*.axt.gz)
      set chr=$f:t:r:r
      gunzip $f
      axtBest -minScore=300 $f:r $chr axtBest/$chr.axt
      axtToPsl axtBest/$chr.axt tSizes qSizes pslBest/${chr}_${tbl}.psl
      gzip $f:r
      echo Done with $chr.
    end
    # If axtBest runs out of memory, split those chromosome files into 
    # smaller pieces and run axtBest in 2 passes.  
    foreach f (run.2/chr{7,Un}.axt.gz)
      set chr=$f:t:r:r
      rm -f xx*
      gunzip -c $f \
        | perl -we '$/="";  $seq=0; \
                    while (<>) { \
                      if (($. % 1000) == 1) { \
                        close(OUT) if ($. > 1000); \
                        $seq++; \
                        open(OUT, ">xx$seq"); \
                      } \
                      print OUT; \
                    } \
                    close(OUT);'
      foreach s (xx*)
        axtBest -minScore=300 $s $chr $s.axtBest
      end
      cat xx?*.axtBest > xx.axtBest
      axtBest -minScore=300 xx.axtBest $chr axtBest/$chr.axt
      rm xx*
      axtToPsl axtBest/$chr.axt tSizes qSizes \
        pslBest/${chr}_${tbl}.psl
      echo Done with $chr.
    end

    # Load tables
     ssh hgwdev
     set base="/cluster/store1/gs.13/build30/blastz.rn1gs13.2002-08-30"
     cd $base/pslBest
     hgLoadPsl rn1 *.psl
     rm -f ~/kent/src/hg/lib/axtInfoFillRn1.sql
     touch ~/kent/src/hg/lib/axtInfoFillRn1.sql
     foreach f ($base/axtBest/chr*.axt)
       set chr=$f:t:r
       echo 'insert into axtInfo values ("hg12","Blastz Best in Genome","'$chr'","'$f'");' \
         >> ~/kent/src/hg/lib/axtInfoFillRn1.sql
     end
     hgsql rn1 < ~/kent/src/hg/lib/axtInfo.sql
     hgsql rn1 < ~/kent/src/hg/lib/axtInfoFillRn1.sql
     cvs add ~/kent/src/hg/lib/axtInfoFillRn1.sql
     cvs ci ~/kent/src/hg/lib/axtInfoFillRn1.sql

PRODUCING GENSCAN PREDICTIONS (TODO)
    
o - Produce contig genscan.gtf genscan.pep and genscanExtra.bed files like so:

        First make sure you have appropriate set up, permissions, etc.
        and you have tried using Parasol to submit and finished a set 
        of jobs successfully.
        
        Load up the cluster with hard-masked contigs in
           /scratch/hg/rn1/mContigs
             
        Log into kkr1u00 (not kk!).  kkr1u00 is the driver node for the small
        cluster (kkr2u00 -kkr8u00. (genscan has problem running on the
        big cluster, due to limitation of memory and swap space on each
        processing node).
                     cd ~/rn1
                     cd bed/genscan
        Make 3 subdirectories for genscan to put their output files in
                mkdir gtf pep subopt
        Generate a list file, genome.list, of all the contigs
                ls -1S /cluster/store4/rn1/mContigs/* >genome.list
        Edit genome.list to remove jobs on all 20 files of chr??_1.fa.masked.
        Those files have pure Ns due to heterochromatin (unsequencable
        stuff) and will cause genscan to run forever.
        
        Create template file, gsub, for gensub2.  For example (3 lines file):
                #LOOP
                /cluster/home/fanhsu/bin/i386/gsBig {check in line+ $(path1)} {check out line gtf/$(root1).gtf} -trans={check out line pep/$(root1).pep} -subopt={check out line subopt/$(root1).bed} -exe=/cluster/home/fanhsu/projects/compbio/bin/genscan-linux/genscan -par=/cluster/home/fanhsu/projects/compbio/bin/genscan-linux/HumanIso.smat -tmp=/tmp -window=2400000
                #ENDLOOP
        Create a file containing a single line.
                echo single > single
        Generate job list file, jobList, for Parasol
                gensub2 genome.list single gsub jobList
        
        Edit jobList to find the line containing "chr12_5.fa.masked"
        and change "-window=2400000" into "-window=1200000", because
        genscan has "not enough memory" problem with this particular
        file.
        
        First issue the following Parasol command:
                para create jobList
        Run the following command, which will try first 10 jobs from jobList
                para try
        Check if these 10 jobs run OK by
                para check
        If they have problems, debug and fix your program, template file, 
        commands, etc. and try again.  If they are OK, then issue the following 
        command, which will ask Parasol to start all the remaining jobs (around
        ~252 jobs).
                para push
        Issue either one of the following two commands to check the 
        status of the cluster and your jobs, until they are done.
                parasol status
                para check
        If any job fails to complete, study the problem and ask Jim to help
        if necessary.

o - Convert these to chromosome level files as so:
     cd ~/rn1
     cd bed/genscan
     liftUp genscan.gtf ../../jkStuff/liftAll.lft warn gtf/*.gtf
     liftUp genscanSubopt.bed ../../jkStuff/liftAll.lft warn subopt/*.bed
     cat pep/*.pep > genscan.pep

o - Load into the database as so:
     ssh hgwdev
     cd ~/rn1/bed/genscan
     ldHgGene rn1 genscan genscan.gtf
     hgPepPred rn1 generic genscanPep genscan.pep
     hgLoadBed rn1 genscanSubopt genscanSubopt.bed


TWINSCAN GENE PREDICTIONS (TODO)

    mkdir -p ~/rn1/bed/twinscan
    cd ~/rn1/bed/twinscan
    wget http://genes.cs.wustl.edu/rat/Gtf.tgz
    wget http://genes.cs.wustl.edu/rat/Ptx.tgz
    gunzip -c Gtf.tgz | tar xvf -
    gunzip -c Ptx.tgz | tar xvf -
    ldHgGene rn1 twinscan chr*.gtf -exon=CDS
    - pare down to id:
    foreach c (1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 X)
      perl -wpe 's/^\>.*\s+source_id\s*\=\s*(\S+).*$/\>$1/;' < \
        chr$c.ptx > chr$c-fixed.fa
    end
    hgPepPred rn1 generic twinscanPep chr*-fixed.fa

NCBI GENE MODELS (TODO)

    mkdir -p ~/rn1/bed/ncbiGenes
    cd ~/rn1/bed/ncbiGenes
    wget ftp://ftp.ncbi.nih.gov/genomes/M_musculus/MGSCv3_Release1/maps/chr_genes.gtf.gz
    wget ftp://ftp.ncbi.nih.gov/genomes/M_musculus/MGSCv3_Release1/protein/protein.fa.gz
    gunzip chr_genes.gtf.gz
    gunzip protein.fa.gz
    - Process the .gtf and .fa together to join IDs
    ../../jkStuff/mungeNCBIids chr_genes.gtf protein.fa |& uniq
    ldHgGene rn1 ncbiGenes chr_genes-fixed.gtf
    hgPepPred rn1 generic ncbiPep protein-fixed.fa

NCBI GENOMESCAN MODELS (TODO)

    mkdir -p ~/rn1/bed/genomeScan
    cd ~/rn1/bed/genomeScan
    wget ftp://ftp.ncbi.nih.gov/genomes/M_musculus/MGSCv3_Release1/maps/chr_GenomeScan.gtf.gz
    # Remove the ".1" at the end of transcript_id's:
    gunzip -c chr_GenomeScan.gtf.gz | \
      perl -wpe 's/transcript_id "([^\"]+)\.1"/transcript_id "$1"/' > \
      chr_GenomeScan-fixed.gtf
    ldHgGene rn1 genomeScan chr_GenomeScan-fixed.gtf
    wget ftp://ftp.ncbi.nih.gov/genomes/M_musculus/MGSCv3_Release1/protein/GS_prot.fsa.gz
    hgPepPred rn1 generic genomeScanPep GS_prot.fsa

PREPARING POST-TRF CHROM-LEVEL MIXED NIBs for blastz (TODO)

    # lift trfMask output to chrom-level... this is a pain because all 
    # trf output was put in the same dir.  maybe next time around, we 
    # can preserve chrom dir structure...
    ssh eieio
    cd ~/rn1
    foreach c (?{,?})
     if (-e $c/lift/ordered.lst) then
       set ntlist = ()
       foreach n (`cat $c/lift/ordered.lst`)
         set ntlist = ($ntlist bed/simpleRepeat/trf/$n.bed)
       end
       liftUp $c/chr$c.trf.bed jkStuff/liftAll.lft warn $ntlist
     endif
    end
    # make trf-masked chrom-level .fa
    foreach c (?{,?})
      cd $c
      if (-e chr$c.trf.bed) then
        echo masking $c...
        cp chr$c.fa chr$c.trf.fa
        maskOutFa -softAdd chr$c.trf.fa chr$c.trf.bed chr$c.trf.fa
      endif
      cd ..
    end
    # make nib
    mkdir trfMixedNib
    foreach c (?{,?})
      if (-e $c/chr$c.trf.fa) then
        faToNib -softMask $c/chr$c.trf.fa trfMixedNib/chr$c.nib
      endif
    end
    rm -rf /scratch/hg/rn1/chromTrfMixedNib
    cp -pR trfMixedNib /scratch/hg/rn1/chromTrfMixedNib


DOING HUMAN/RAT ALIGMENTS (todo)

o - Download the lower-case-masked assembly and put it in
    eieio:/cluster/store1/a2ms.
   
o - Download the assembled rat genome in lower-case
    masked form to /cluster/store1/arachne.3/whole.  
    Execute the script splitAndCopy.csh to chop it
    into roughly 50M pieces in arachne.3/parts
o - Set up the para job to do the alignment as so:
       ssh eieio
       cd /cluster/store4/rn1
       mkdir blatRat.phusion
       cd blatRat.phusion
       ls -1S /scratch/hg/gs.13/build30/contigTrf/* > human.lst
       ls -1 /scratch/hg/rn1/contigs.1126/* > rat.lst
    Make a file 'gsub' with the following three lines in it
#LOOP
/cluster/home/kent/bin/i386/blat -q=dnax -t=dnax {check in line+ $(path2)} {check in line+ $(path1)}  {check out line+ psl/$(root2)_$(root1).psl} -minScore=20 -minIdentity=20 -tileSize=4 -minMatch=2 -oneOff=0 -ooc={check in exists /scratch/hg/h/4.pooc} -qMask=lower -mask=lower
#ENDLOOP
    Process this into a para file and launch the first set
    of jobs (10,000 out of 70,000) as so:
        gensub2 rat.lst human.lst gsub spec
        para create spec
        para push
    Do a 'para check' after a few minutes and make sure everything is right.
        para time > time

o - Sort alignments as so 
       ssh eieio
       cd /cluster/store4/rn1/blatRat
       pslCat -dir -check psl | liftUp -type=.psl stdout ../liftAll.lft warn stdin | pslSortAcc nohead chrom /cluster/store2/temp stdin
o - Get rid of big pile-ups due to contamination as so:
       cd chrom
       foreach i (*.psl)
           echo $i
           mv $i xxx
           pslUnpile -maxPile=600 xxx $i
       rm xxx
       end
o - Remove long redundant bits from read names by making a file
    called subs.in with the following line:
        gnl|ti^ti
        contig_^tig_
    and running the commands
        cd ~/rat/vsOo33/blatRat.phusion/chrom
        subs -e -c ^ *.psl > /dev/null
o - Copy over to network where database is:
        ssh kks00
        cd ~/rn1/bed
        mkdir blatRat
        mkdir blatRat/ph.chrom600
        cd !$
        cp /cluster/store4/rn1/blatRat.phusion/chrom/*.psl .
o - Rename to correspond with tables as so and load into database:
       ssh hgwdev
       cd ~/rn1/bed/blatRat/ph.chrom600
       foreach i (chr?{,?}{,_random}.psl)
           set r = $i:r
           mv $i ${r}_blatRat.psl
       end
       hgLoadPsl rn1 *.psl
o - load sequence into database as so:
        ssh kks00
        faSplit about /projects/hg3/rat/arachne.3/whole/Unplaced.mfa 1200000000 /projects/hg3/rat/arachne.3/whole/unplaced
        ssh hgwdev
        hgLoadRna addSeq '-abbr=gnl|' rn1 /projects/hg3/rat/arachne.3/whole/unpla*.fa
        hgLoadRna addSeq '-abbr=con' rn1 /projects/hg3/rat/arachne.3/whole/SET*.mfa
    This will take quite some time.  Perhaps an hour .

o - Produce 'best in genome' filtered version:
        ssh kks00
        cd ~/rat/vsOo33
        pslSort dirs blatRatAll.psl temp blatRat
        pslReps blatRatAll.psl bestRatAll.psl /dev/null -singleHit -minCover=0.3 -minIdentity=0.1
        pslSortAcc nohead bestRat temp bestRatAll.psl
        cd bestRat
        foreach i (chr?{,?}{,_random}.psl)
           set r = $i:r
           mv $i ${r}_bestRat.psl
        end
o - Load best in genome into database as so:
        ssh hgwdev
        cd ~/rat/vsOo33/bestRat
        hgLoadPsl rn1 *.psl

PRODUCING CROSS_SPECIES mRNA ALIGMENTS (TODO)

Here you align vertebrate mRNAs against the masked genome on the
cluster you set up during the previous step.

Make sure that gbpri, gbmam, gbrod, and gbvert are downloaded from Genbank into
/cluster/store2/genbank.132 and unpacked by organism into /cluster/store2/mrna.132/org. 

Set up cluster run more or less as so:
      ssh kk
      cd ~/rn1/bed
      mkdir xenoMrna
      cd xenoMrna
      ls -1S /scratch/hg/rn1/mContigs/* > genome.lst
      ls -1S /scratch/hg/mrna.132/org/*/mrna.fa > allMrna
Then edit allMrna removing the Mus.musculus line,  and writing
the first line into 1.org, the second line into 2.org,  and
so forth.  After the 6th line just leave the rest in 7.org.
Then
      ls -1 *.org > rna.lst
      cp ~/rn1/bed/xenoMrna/gsub .
      gensub2 genome.lst rna.lst gsub spec
      para create
      para try
      para check
If all looks well do
      para push.

Sort xeno mRNA alignments as so:
       ssh eieio
       cd ~/rn1/bed/xenoMrna
       pslSort dirs raw.psl /cluster/store2/temp psl
       pslReps raw.psl cooked.psl /dev/null -minAli=0.25
       liftUp chrom.psl ../../jkStuff/liftAll.lft warn cooked.psl
       pslSortAcc nohead chrom /cluster/store2/temp chrom.psl
       pslCat -dir chrom > xenoMrna.psl
       rm -r chrom raw.psl cooked.psl chrom.psl

Load into database as so:
       ssh hgwdev
       cd ~/rn1/bed/xenoMrna
       hgLoadPsl rn1 xenoMrna.psl -tNameIx
Load other RNA into database as so:
       cd /cluster/store2/mrna.132/topOrg
Note - need to describe how topOrg was made.  See topOrg/README...
       foreach i (*/mrna.fa)
           hgLoadRna add rn1 /cluster/store2/mrna.132/org/$i $i:r.ra -type=$i:r
           echo done $i
        end


PRODUCING TETRAODON FISH ALIGNMENTS (TODO)

o - Download sequence from ... and put it on the cluster local disk
    at
       /scratch/hg/fish
o - Do fish/rat alignments.
       ssh kk
       cd ~/rn1/bed
       mkdir blatFish
       cd blatFish
       mkdir psl
       ls -1S /scratch/hg/fish/* > fish.lst
       ls -1S /scratch/hg/rn1/trfFa/* > rat.lst
       cp ~/lastRn/blatFish/gsub .
       gensub2 rat.lst fish.lst gsub spec
       para create spec
       para try
     Make sure jobs are going ok with para check.  Then
       para push
     wait about 2 hours and do another
       para push
     do para checks and if necessary para pushes until done
     or use para shove.
o - Sort alignments as so 
       pslCat -dir psl | liftUp -type=.psl stdout ~/rn1/jkStuff/liftAll.lft warn stdin | pslSortAcc nohead chrom /cluster/store2/temp stdin
o - Copy to hgwdev:/scratch.  Rename to correspond with tables as so and 
    load into database:
       ssh hgwdev
       cd ~/rn1/bed/blatFish/chrom
       foreach i (chr?{,?}{,_random}.psl)
           set r = $i:r
           mv $i ${r}_blatFish.psl
       end
       hgLoadPsl rn1 *.psl
       hgLoadRna addSeq rn1 /cluster/store2/fish/seq15jun2001/*.fa


PRODUCING FUGU FISH ALIGNMENTS (TODO)

o - Download sequence to /cluster/store3/fuguSeq from ... and put it on the cluster local disk
    at /scratch/hg/fugu on kkstore.
Sequence was downloaded from:
ftp://ftp.jgi-psf.org/pub/JGI_data/Fugu/fugu_v3_mask.fasta.Z
ftp://ftp.jgi-psf.org/pub/JGI_data/Fugu/fugu_v3_prot.fasta.Z

faSplit sequence ../fugu_v3_mask.fasta 1000 fuguSplit
o - Do fish/rat alignments.
       ssh kk
       cd ~/rn1/bed
       mkdir blatFugu
       cd blatFugu
       mkdir psl
       ls -1S /scratch/hg/fugu/* > fugu.lst
       ls -1S /scratch/hg/rn1/trfFa.0802/* > rat.lst
       # Run mkdirs.sh
       # Edit gsub to fit the dir srtucture
       gensub2 rat.lst fugu.lst gsub spec
       para create spec
       para try
     Make sure jobs are going ok with para check.  Then
       para push
     wait about 2 hours and do another
       para push
       do para checks and if necessary para pushes until done
     or use para shove.
o - Sort alignments as so 
       pslCat -dir psl/* | liftUp -type=.psl stdout ~/rn1/jkStuff/liftAll.lft warn stdin | pslSortAcc nohead chrom /oldscratch stdin
o - ssh hgwdev
    load into database:
       ssh hgwdev
       cd ~/rn1/bed/blatFugu/chrom
       foreach i (chr?{,?}{,_random}.psl)
           set r = $i:r
           mv $i ${r}_blatFugu.psl
       end
       hgLoadPsl rn1 *.psl
       hgLoadRna addSeq rn1 /cluster/store3/fuguSeq/fugu_v3_mask.fasta


LOAD GENEID GENES (TODO)
     cd ~/rn1/bed
     mkdir geneid
     cd geneid
     mkdir download
     cd download
   Now download *.gtf and *.prot from 
   http://www1.imim.es/genepredictions/M.musculus/mmFeb2002/geneid_v1.1
   Get rid of the extra .N in the transcripts with subs.  
     cd ..
     cp ~/lastRn/bed/geneid/subs .
     subs -e download/*.gtf > /dev/null
     ldHgGene rn1 geneid download/*.gtf -exon=CDS
     hgPepPred rn1 generic geneidPep download/*.prot

SGP GENE PREDICTIONS (TODO)
     cd ~/rn1/bed
     mkdir sgp
     cd sgp
     mkdir download
     cd download
   Now download *.gtf and *.prot from 
   http://www1.imim.es/genepredictions/M.musculus/mmFeb2002/SGP/
   Get rid of the extra .N in the transcripts with subs.  
     cd ..
     cp ~/lastRn/bed/sgp/subs .
     subs -e download/*.gtf > /dev/null
     ldHgGene rn1 sgpGene download/*.gtf -exon=CDS
     hgPepPred rn1 generic sgpPep download/*.prot


TIGR GENE INDEX (TODO)
    mkdir -p ~/rn1/bed/tigr
    cd ~/rn1/bed/tigr
    wget ftp://ftp.tigr.org/private/NHGI_mgi_jiashu/TGI_track_RatGenome_Feb2002.tgz
    gunzip -c TGI_track_RatGenome_Feb2002.tgz | tar xvf -
    foreach f (*cattle*)
      set f1 = `echo $f | sed -e 's/cattle/cow/g'`
      mv $f $f1
    end
    foreach o (rat cow human pig rat)
      setenv O $o
      foreach f (chr*_$o*s)
        tail +2 $f | perl -wpe 's /THC/TC/; s/(TH?C\d+)/$ENV{O}_$1/;' > $f.gff
      end
    end
    ldHgGene -exon=TC rn1 tigrGeneIndex *.gff


LOAD STS MAP (todo)
     - login to hgwdev
      cd ~/rn1/bed
      rn1 < ~/src/hg/lib/stsMap.sql
      mkdir stsMap
      cd stsMap
      bedSort /projects/cc/hg/mapplots/data/tracks/build28/stsMap.bed stsMap.bed
      - Enter database with "rn1" command.
      - At mysql> prompt type in:
          load data local infile 'stsMap.bed' into table stsMap;
      - At mysql> prompt type

LOAD MGI IDs (TODO)
      - The Locuslink ID to MGI IDs converstion data file,
        LL2MGI.txt, from Jackson Lab should be found under
        ~/rn1/bed/refSeq
      - login to hgwdev
      
      cd ~/rn1/bed/refSeq
      rn1 < ~/src/hg/lib/mgiID.sql
      - Enter database with "rn1" command.
      - At mysql> prompt type in:
          load data local infile 'LL2MGI.txt' into table MGIid;
      - At mysql> prompt type
          quit

LOAD CHROMOSOME BANDS (todo)
      - login to hgwdev
      cd /cluster/store4/rn1/bed
      mkdir cytoBands
      cp /projects/cc/hg/mapplots/data/tracks/build28/cytobands.bed cytoBands
      rn1 < ~/src/hg/lib/cytoBand.sql
      Enter database with "rn1" command.
      - At mysql> prompt type in:
          load data local infile 'cytobands.bed' into table cytoBand;
      - At mysql> prompt type
          quit

LOAD RATREF TRACK (todo)
    First copy in data from kkstore to ~/rn1/bed/ratRef.  
    Then substitute 'genome' for the appropriate chromosome 
    in each of the alignment files.  Finally do:
       hgRefAlign webb rn1 ratRef *.alignments

LOAD AVID RAT TRACK (todo)
      ssh cc98
      cd ~/rn1/bed
      mkdir avidRat
      cd avidRat
      wget http://pipeline.lbl.gov/tableCS-LBNL.txt
      hgAvidShortBed *.txt avidRepeat.bed avidUnique.bed
      hgLoadBed avidRepeat avidRepeat.bed
      hgLoadBed avidUnique avidUnique.bed

LOAD SNPS (TODO)
      - ssh hgwdev
      - cd ~/rn1/bed
      - mkdir snp
      - cd snp
      - Download SNPs from ftp://ftp.ncbi.nlm.nih.gov/pub/sherry/rat.b27.out.gz
      - Unpack.
        createBed < rat.b27.out > snpNih.bed
        hgLoadBed rn1 snpNih snpNih.bed

LOAD CPGISSLANDS (todo)
     login to hgwdev
       cd /cluster/store4/rn1/bed
       mkdir cpgIsland
       cd cpgIsland
     Get cpgisland tarball out of email from Asif (achinwal@watson.wustl.edu)
     and unpack it.
       awk -f filter.awk */ctg*/*.cpg > cpgIsland.bed
       hgsql rn1 < ~/src/hg/lib/cpgIsland.sql
       hgsql rn1 
     At mysql> prompt type in:
       load data local infile 'cpgIsland.bed' into table cpgIsland

LOAD ENSEMBL ESTs (TODO)
     ln -s /cluster/store4/rn1 ~/rn1
     mkdir -p ~/rn1/bed/ensembl
     cd ~/rn1/bed/ensembl
     wget http://www.ebi.ac.uk/~stabenau/rat-est.gz
     wget http://www.ebi.ac.uk/~stabenau/rat-est.pep.gz
     gunzip -c rat-est.gz | \
       perl -w -p -e 's/^(\w)/chr$1/' > rat-est-fixed.gtf
     ldHgGene rn1 ensEst rat-est-fixed.gtf
> The id behind '>' is internal and was not in our gtf dump, so
> you have to do some more parsing.
     # pick out the transcript= attribute -- that's the id to use:
     # also remove the first line:
     gunzip -c rat-est.pep.gz | tail +2 | \
       perl -w -p -e 's/^\>gene_id=.*transcript=(\w+)\s+.*$/\>$1/' > \
       rat-est-fixed.pep
     hgPepPred rn1 generic ensEstPep rat-est-fixed.pep

LOAD ENSEMBLE GENES (TODO)
     mkdir -p ~/rn1/bed/ensembl
     cd ~/rn1/bed/ensembl
     wget http://www.ebi.ac.uk/~stabenau/rat-ensembl.gz
     wget http://www.ebi.ac.uk/~stabenau/rat-ensembl.pep.gz
     gunzip -c rat-ensembl.gz | \
       perl -w -p -e 's/^(\w)/chr$1/' > rat-ensembl-fixed.gtf
     ldHgGene rn1 ensGene rat-ensembl-fixed.gtf
> rat-ensembl contains stopcodons, due to some glitches in our
> genebuild. The id behind '>' is internal and was not in our gtf dump, so
> you have to do some more parsing.
# pick out the transcript= attribute -- that's the id to use:
# also remove the first line:
     tail +2 rat-ensembl.pep | \
       perl -w -p -e 's/^\>gene_id=.*transcript=(\w+)\s+.*$/\>$1/' > \
       rat-ensembl-fixed.pep
     hgPepPred rn1 generic ensPep rat-ensembl-fixed.pep

LOAD RNAGENES (todo)
      - login to hgwdev
      - cd ~kent/src/hg/lib
      - rn1 < rnaGene.sql
      - cd /cluster/store4/rn1/bed
      - mkdir rnaGene
      - cd rnaGene
      - download data from ftp.genetics.wustl.edu/pub/eddy/pickup/ncrna-oo27.gff.gz
      - gunzip *.gz
      - liftUp chrom.gff ../../jkStuff/liftAll.lft carry ncrna-oo27.gff
      - hgRnaGenes rn1 chrom.gff

LOAD EXOFISH (todo)
     - login to hgwdev
     - cd /cluster/store4/rn1/bed
     - mkdir exoFish
     - cd exoFish
     - rn1 < ~kent/src/hg/lib/exoFish.sql
     - Put email attatchment from Olivier Jaillon (ojaaillon@genoscope.cns.fr)
       into /cluster/store4/rn1/bed/exoFish/all_maping_ecore
     - awk -f filter.awk all_maping_ecore > exoFish.bed
     - hgLoadBed rn1 exoFish exoFish.bed

LOAD GENIE (TODO)
     mkdir -p ~/rn1/bed/genieAlt
     cd ~/rn1/bed/genieAlt
     wget http://www.neomorphic.com/mgap/mgscv3/gtf/mgscv3.genie.gtf.tgz
     gunzip -c mgscv3.genie.gtf.tgz | tar xvf -
     ldHgGene rn1 genieAlt mgscv3.genie.gtf/chr*.gtf
     wget http://www.neomorphic.com/mgap/mgscv3/fa/mgscv3.aa.tgz
     gunzip -c mgscv3.aa.tgz | tar xvf -
     hgPepPred rn1 genie geniePep chr*.aa.fa

LOAD GENIE CLONE BOUNDS (TODO)
     mkdir -p ~/rn1/bed/genieBounds
     cd ~/rn1/bed/genieBounds
     wget http://www.neomorphic.com/mgap/mgscv3/cb.bed/mgscv3_cb.bed.tgz
     gunzip -c mgscv3_cb.bed.tgz | tar xvf -
     - Trim the track definition from each file (these are actually custom 
       track files):
     foreach c (1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 X Un)
       tail +2 chr${c}_cb.bed > chr${c}_cb-fixed.bed
     end
     hgLoadBed rn1 genieBounds *-fixed.bed

LOAD JACKSON LABS QTL (TODO)
     Carol Bult at Jackson Labs sent us tab-separated QTL info -- 
     See RT289.  
     - Reformat QTL info into bed 6 + (really bed 5, no strand).
       There will be some complaints about lines that are missing 
       chromStart, chromEnd (they're on MIT Markers that we don't have 
       in our stsMapRat table...?)
     cd ~/rn1/bed/qtl
     ./fixit.pl mgi_qtl.rpt > mgi_qtl.bed
     hgLoadBed -noBin -tab -sqlTable=$HOME/kent/src/hg/lib/jaxQTL.sql \
       rn1 jaxQTL mgi_qtl.bed

LOAD SOFTBERRY GENES (todo)
     - ln -s /cluster/store4/rn1 ~/rn1
     - cd ~/rn1/bed
     - mkdir softberry
     - cd softberry
     - get ftp://www.softberry.com/pub/SC_MOU_NOV01/softb_mou_genes_nov01.tar.gz
     ldHgGene rn1 softberryGene chr*.gff
     hgPepPred rn1 softberry *.protein
     hgSoftberryHom rn1 *.protein

LOAD GENOMIC DUPES (todo)
o - Load genomic dupes
    ssh hgwdev
    cd ~/rn1/bed
    mkdir genomicDups
    cd genomicDups
    wget http://codon/jab/web/takeoff/oo33_dups_for_kent.zip
    unzip *.zip
    awk -f filter.awk oo33_dups_for_kent > genomicDups.bed
    hgsql rn1 < ~/src/hg/lib/genomicDups.sql
    hgLoadBed rn1 -oldTable genomicDups genomicDupes.bed

FAKING DATA FROM PREVIOUS VERSION
(This is just for until proper track arrives.  Rescues about
97% of data  Just an experiment, not really followed through on).

o - Rescuing STS track:
     - log onto hgwdev
     - mkdir ~/rn1/rescue
     - cd !$
     - mkdir sts
     - cd sts
     - bedDown hg3 mapGenethon sts.fa sts.tab
     - echo ~/rn1/sts.fa > fa.lst
     - pslOoJobs ~/rn1 ~/rn1/rescue/sts/fa.lst ~/rn1/rescue/sts g2g
     - log onto cc01
     - cc ~/rn1/rescue/sts
     - split all.con into 3 parts and condor_submit each part
     - wait for assembly to finish
     - cd psl
     - mkdir all
     - ln ?/*.psl ??/*.psl *.psl all
     - pslSort dirs raw.psl temp all
     - pslReps raw.psl contig.psl /dev/null
     - rm raw.psl
     - liftUp chrom.psl ../../../jkStuff/liftAll.lft carry contig.psl
     - rm contig.psl
     - mv chrom.psl ../convert.psl


