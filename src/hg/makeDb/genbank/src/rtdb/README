   This is the details about the automatic updating of RTDB related tracks
for MGC.  RTDB is the RT-PCR clones for the C-list.  This C-list is only
for human MGC genes but in general it can be for any MGC species.

1. Washington U. setup

   A suggested configuration of RTDB on the supplying end of the data would
     be:

    I. RTDB releases are put into a single file for each genome assembly, 
       i.e. a .tar.gz file, e.g.: 
 
           rtdb.hg17.tar.gz
           rtdb.mm6.tar.gz

   II. When copying files to that directory, do so in an atomic manner, e.g.: 

           cp rtdb.tar.gz <directory>/rtdb.tar.gz.TMP
           mv <directory>/rtdb.tar.gz.TMP <directory>/rtdb.tar.gz

  III. RTDB files organized the following way, e.g. for rtdb.hg17.tar.gz:

           hg17/mgcWUPcrHit.bed
           hg17/mgcWUPcrHit.ra
           hg17/mgcWUPcrHit.html
             (C-list successes)
           hg17/mgcWUPcrInProgress.bed
           hg17/mgcWUPcrInProgress.ra
           hg17/mgcWUPcrInProgress.html
             (c-list pending)
           hg17/mgcWUPcrFail.bed
           hg17/mgcWUPcrFail.ra
           hg17/mgcWUPcrFail.html
             (c-list failed)
           hg17/rtdb.md5
       
       Note the extra subdirectory corresponding to the genome assembly.  That's 
       mostly because it's always sort of good practice to have tarballs unpack their
       into a subdirectory to avoid making a mess in the working directory.  Those 
       funny filenames are named that way to match the table names in the UCSC 
       database.  The rtdb.md5 file is for checksumming, and can be created like:
   
           cd hg17/
           md5sum * > rtdb.md5 

    V. Make RTDB files available through HTTP, or even better FTP.

2. UCSC setup

    I. Configuration files and update scripts in CVS module:
           
           kent/src/hg/makeDb/genbank
 
       specifically, put configuration file rtdb.conf in 

           kent/src/hg/makeDb/genbank/etc

       and all download programs and scripts in

           kent/src/hg/makeDb/genbank/src/rtdb

   II. Files from (I) checked out for use in /cluster/data/genbank
       This location is also where downloaded RTDB goes.  Specifcally, while data is
       being downloaded it goes in:
   
           /cluster/data/genbank/data/download/rtdb

        where it gets decompressed like:

           /cluster/data/genbank/data/download/rtdb/rtdb.tar.gz
                                |
                                V
           /cluster/data/genbank/data/processed/rtdb/03.06.2005/*

       note the addition of the current date to the directory structure. 

  III. The RTDB data goes into the MySQL databases on the mgc computer.

   IV. The RTDB data goes in the database according to its directory. For example,
       the files 

           hg17/mgcWUPcrHit.bed
           hg17/mgcWUPcrInProgress.bed
           hg17/mgcWUPcrFail.bed

       go in the hg17 database as the tables mgcWUPcrHit, mgcWUPcrInProgress, and
       mgcWUPcrFail.  

   IV. The trackDb settings are a bit tricky because the .ra and .html files are
       being provided with the assumption that they're updated and modified along
       with the .bed file.  The idea then is to run hgTrackDb upon the arrival of
       new data, but have the destination table be trackDbLocal_rtdb, where it
       uses the db.trackDbLocal setting in the hg.conf file to display the tracks
       on the browser without having to update the main trackDb table.  For
       example:
  
           hgTrackDb -raName=mgcWUPcrHit.ra "" hg17 trackDbLocal_rtdb trackDb.sql .

    V. Creation of a script that downloads, puts data in the right place, and
       updates the the database correctly.  This script can be run by cron
       or through the use of a CGI.  The CGI program should be non-interactive
       and only display the status of the update script or an error if the 
       cron is currently running the script.

3. RTDB update sequence of events:

    A. A cron job running every few minutes under user rtdb detects an 
       updated RTDB.  

    B. The rtdb.conf file is read and settings are such as:
       
           i. Lock file location.
          ii. RTDB directory URL (WashU HTTP or FTP).
         iii. Local download directory path.

    B. A lock file is created to prevent simultaneous updates by cron and 
       the CGI.

    C. The download directory is created in /cluster/data/genbank/download/rtdb

    D. The data is downloaded to the download directory.

    E. The data is decompressed into the "processed" directory and checksummed.

    F. The .bed files are loaded into appropriate databases with hgLoadBed.

    G. hgTrackDb loads track information into trackDbLocal_rtdb on assembly 
       database on mgc.

    H. The script reports a successful exit and exits after releasing the lock.

