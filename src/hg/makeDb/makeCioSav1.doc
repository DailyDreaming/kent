#!/bin/csh -f # set emacs mode
exit; # don't actually run this like a script :)

# Ciona Savigny from Broad/MIT  4/25/2003 data version
#       

# DOWNLOAD SEQUENCE (2004-05-11 kate)
# Download description:
#    http://www.broad.mit.edu/cgi-bin/annotation/ciona/download_license.cgi
# Assembly description:
#   http://www.broad.mit.edu/annotation/ciona/assembly.html
#
# 3 sets of sequences, with quality scores -- "paired scaffolds", "paired scaffold remainders"
# and "separate scaffolds".  Assembly details on the web site.

    ssh kksilo
    mkdir /cluster/store7/cioSav1
    ln -s /cluster/store7/cioSav1 /cluster/data
    cd /cluster/data/cioSav1
    wget ftp://ftp.broad.mit.edu/pub/annotation/ciona/assembly_4_25_2003/paired_scaffold_remainders.fa.gz
    wget ftp://ftp.broad.mit.edu/pub/annotation/ciona/assembly_4_25_2003/paired_scaffold_remainders.qual.gz
    wget ftp://ftp.broad.mit.edu/pub/annotation/ciona/assembly_4_25_2003/paired_scaffolds.fa.gz
    wget ftp://ftp.broad.mit.edu/pub/annotation/ciona/assembly_4_25_2003/paired_scaffolds.qual.gz
    wget ftp://ftp.broad.mit.edu/pub/annotation/ciona/assembly_4_25_2003/separate_scaffolds.fa.gz
    wget ftp://ftp.broad.mit.edu/pub/annotation/ciona/assembly_4_25_2003/separate_scaffolds.qual.gz

    gunzip paired_scaffolds.fa.gz
    mkdir scaffolds
    sed -e "s/paired_scaffold/ps/" paired_scaffolds.fa | faSplit byname paired_scaffolds.fa scaffolds/
    mkdir nib
    cd nib
    foreach i (../scaffolds/*.fa)
        faToNib -softMask $i `basename $i .fa`.nib
    end

### CREATE DATABASE
    # Create the database.
    ssh hgwdev
    echo 'create database cioSav1' | hgsql ''
# CREATING GRP TABLE FOR TRACK GROUPING 
    echo "create table grp (PRIMARY KEY(NAME)) select * from hg17.grp" \
      | hgsql cioSav1


#    echo 'insert into blatServers values("cioSav1", "blat10", "17780", "1"); \
#          insert into blatServers values("cioSav1", "blat10", "17781", "0");' \
#      | hgsql -h genome-testdb hgcentraltest

    mkdir /gbdb/cioSav1
    ln -s /cluster/data/cioSav1/nib /gbdb/cioSav1/nib
    hgsql cioSav1  < ~/kent/src/hg/lib/chromInfo.sql
    cd /cluster/data/cioSav1
    hgNibSeq -preMadeNib cioSav1 /gbdb/cioSav1/nib scaffolds/*.fa

    mkdir -p ~/kent/src/hg/makeDb/trackDb/squirt/cioSav1
    
    cd $HOME/kent/src/hg/makeDb/trackDb
    cvsup
    # Edit that makefile to add cioSav1 in all the right places and do
    make 
    cvs commit -m "Added cioSav1." makefile

    # Add dbDb and defaultDb entries:
    echo 'insert into dbDb (name, description, nibPath, organism,  \
          defaultPos, active, orderKey, genome, scientificName,  \
          htmlPath, hgNearOk, hgPbOk, sourceName)  \
          values("cioSav1", "Sept. 2001", \
          "/gbdb/cioSav1/nib", "C. savignyi", "ps_233", 1, \
          51, "C. savignyi", "Ciona Savignyi", \
          "/gbdb/cioSav1/html/description.html", 0, 0, \
          "Broad");'  | hgsql -h genome-testdb hgcentraltest
    echo 'insert into defaultDb (genome, name) \
          values ("C. savignyi", "cioSav1");' \
          | hgsql -h genome-testdb hgcentraltest


# MAKE DESCRIPTION/SAMPLE POSITION HTML PAGE 
    mkdir /cluster/data/cioSav1/html
    cd /cluster/data/cioSav1/html

    mkdir -p ~/kent/src/hg/makeDb/trackDb/squirt/cioSav1                                               
    # make a symbolic link from /gbdb/cioSav1/html to /cluster/data/cioSav1/html                          
    ln -s /cluster/data/cioSav1/html /gbdb/cioSav1/html                                                   
    # NEED TO ADD DESCRIPTION.HTML PAGE 

    # make gcPercent table
    mkdir -p ~/cioSav1/bed/gcPercent
    cd ~/cioSav1/bed/gcPercent
    hgsql cioSav1  < ~/kent/src/hg/lib/gcPercent.sql
    hgGcPercent cioSav1 /cluster/data/cioSav1/nib

