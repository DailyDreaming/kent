#!/bin/csh -f # set emacs mode
exit; # don't actually run this like a script :)

# Bos taurus 
# Btau_1.0 from Baylor
# September 2004
# contigs and scaffolds, no chromosomes
# WGS, Atlas assembler, 3x coverage
# ftp://ftp.hgsc.bcm.tmc.edu/pub/data/Btaurus/fasta/Btau20040927-freeze
# anonymous ftp, no login/password needed

# DOWNLOAD SEQUENCE (DONE Sept. 30, 2004 Heather)
    ssh kksilo
    mkdir /cluster/store8/bosTau1
    cd /cluster/data
    ln -s /cluster/store8/bosTau1 bosTau1
    cd /cluster/data/bosTau1
    mkdir downloads
    cd downloads

    mkdir Bin0
    cd Bin0
    wget ftp://ftp.hgsc.bcm.tmc.edu/pub/data/Btaurus/fasta/Btau20040927-freeze/Bin0/Btau20040927-freeze-bin0.fa.gz
    wget ftp://ftp.hgsc.bcm.tmc.edu/pub/data/Btaurus/fasta/Btau20040927-freeze/Bin0/Btau20040927-freeze-bin0.fa.qual.gz
    wget ftp://ftp.hgsc.bcm.tmc.edu/pub/data/Btaurus/fasta/Btau20040927-freeze/Bin0/Btau_lib_insert_size_20040927.tbl.gz
    cd ..

    mkdir contigs
    cd contigs
    wget ftp://ftp.hgsc.bcm.tmc.edu/pub/data/Btaurus/fasta/Btau20040927-freeze/contigs/Btau20040927-freeze-contigs.fa.gz
    wget ftp://ftp.hgsc.bcm.tmc.edu/pub/data/Btaurus/fasta/Btau20040927-freeze/contigs/Btau20040927-freeze-contigs.fa.qual.gz
    wget ftp://ftp.hgsc.bcm.tmc.edu/pub/data/Btaurus/fasta/Btau20040927-freeze/contigs/Btau_v1.0_20040927.agp.gz
    wget ftp://ftp.hgsc.bcm.tmc.edu/pub/data/Btaurus/fasta/Btau20040927-freeze/contigs/AAFC01_accs.gz
    cd ..

    mkdir linearScaffolds
    cd linearScaffolds
    wget ftp://ftp.hgsc.bcm.tmc.edu/pub/data/Btaurus/fasta/Btau20040927-freeze/linearScaffolds/Btau20040927-freeze-assembly.fa.gz
    wget ftp://ftp.hgsc.bcm.tmc.edu/pub/data/Btaurus/fasta/Btau20040927-freeze/linearScaffolds/Btau20040927-freeze-assembly.fa.qual.gz
    cd ..

    mkdir repeat-reads
    cd repeat-reads
    wget ftp://ftp.hgsc.bcm.tmc.edu/pub/data/Btaurus/fasta/Btau20040927-freeze/repeat-reads/Btau20040927-freeze-repeat-reads.fa.gz
    wget ftp://ftp.hgsc.bcm.tmc.edu/pub/data/Btaurus/fasta/Btau20040927-freeze/repeat-reads/Btau20040927-freeze-repeat-reads.fa.qual.gz
    cd ..

# GUNZIP
  gunzip */*.gz

# CHECK FILES

# Check that IDs in .fa match IDs in .qual
  
  ssh kksilo
  cd /cluster/data/bosTau1/downloads
  # foreach Bin0 contigs linearScaffolds repeat-reads
  grep ">" *.fa > id.fa
  grep ">" *.qual > id.qual
  diff id.fa id.qual

  # this takes about 5-10 minutes
  /cluster/bin/i386/checkAgpAndFa contigs/Btau_v1.0_20040927.gap linearScaffolds/Btau20040927-freeze >& check.out
  /cluster/bin/i386/checkAgpAndFa contigs/Btau_v1.0_20040927.gap linearScaffolds/Btau20040927-freeze > check.err


# SPLIT SCAFFOLDS (DONE Sep. 30, 2004, Heather)

  ssh eieio
  cd /cluster/data/bosTau1
  mkdir scaffolds
  /cluster/bin/i386/faSplit byname downloads/linearScaffolds/Btau20040927-freeze-assembly.fa scaffolds -outDirDepth=3
  # not sure why these didn't get put under scaffolds directory
  mv 1 scaffolds
  mv 2 scaffolds
  mv 3 scaffolds
  mv 4 scaffolds
  etc.

# MAKE 2BIT NIB FILE (DONE Oct.1, 2004, Heather)

  ssh kksilo
  cd /cluster/data/bosTau1/linearScaffolds
  /cluster/bin/i386/faToTwoBit Btau20040927-freeze-assembly.fa bosTau1.2bit
  /cluster/bin/i386/twoBitToFa bosTau1.2bit check.fa
  mv bosTau1.2bit ../..
  # TO DO: split up so diff will work
  # diff Btau20040927-freeze-assembly.fa check.fa
  # note: size match
  ssh hgwdev
  mkdir /gbdb/bosTau1
  mkdir /gbdb/bosTau1/nib
  ln -s /cluster/data/bosTau1/bosTau1.2bit /gbdb/bosTau1/nib

# CREATE DATABASE

  ssh hgwdev
  hgsql hg17
  create database bosTau1;
  use bosTau1;
  create table grp (PRIMARY KEY(NAME)) select * from hg17.grp;
  # add rows to hgcentraltest on hgwbeta in dbDb and defaultDb
  # set orderKey past dog, before mouse

# CREATE GAP TABLE

  ssh hgwdev
  cd kent/src/hg/lib
  # remove bin column for now
  hgsql bosTau1 < gap2.sql
  cd /cluster/data/bosTau1/download/contigs
  grep fragment Btau_v1.0_20040927.agp > fragment.txt
  hgsql bosTau1
  load data local infile 'fragment.txt' into table gap
  # create trackDb/cow/bosTau1/gap.html

# CREATE CHROMINFO TABLE
# an improvement here would be to have getMaxCoord output the 2bit file name
  ssh hgwdev
  cd /cluster/data/bosTau1
  # get coordinates from agp and put in database table
  getcoords.pl < downloads/contigs/Btau_v1.0_20040927.agp > scaffolds.coords
  hgsql bosTau1 < coords.sql
  load data local infile 'scaffolds.coords' into table scaffoldCoords
  # calculate maximum coords; check that start coord is always 1
  /cluster/home/heather/bin/i386/GetMaxCoord > getMaxCoord.bosTau1
  # edit chromInfo.sql; allow fileName to be null
  cp ~heather/kent/src/hg/lib/chromInfo.sql .
  hgsql bosTau1 < chromInfo.sql
  load data local infile 'getMaxCoord.bosTau1' into table chromInfo
  update chromInfo set fileName = "/gbdb/bosTau1/nib/bosTau1.2bit"
