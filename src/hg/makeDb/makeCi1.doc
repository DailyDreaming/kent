#!/bin/csh -f # set emacs mode
exit; # don't actually run this like a script :)

# Ciona Intestinalis V1.0 from JGI

DOWNLOAD SEQUENCE 

    ssh eieio
    mkdir /cluster/store5/squirt
    cd /cluster/store5/squirt
    wget ftp://ftp.jgi-psf.org/pub/JGI_data/Ciona/v1.0/ciona.rm.fasta.gz
    gunzip ciona.rm.fasta

    # translate to nib
    ln -s /cluster/store5/squirt/ci1 ~/ci1
    cd ~/ci1
    mkdir scaffolds
    cd scaffolds

    # spoof faSplit into making one file per scaffold
    # assumes # of scaffolds is less than 9999
    faSplit sequence ../ciona.rm.fasta 9999 Scaffold_
    cd ..

    mkdir nib
    foreach i (../scaffolds/*.fa)
        faToNib $i `basename $i .fa`.nib
    end

CREATE DATABASE
    # Create the database.
    ssh hgwdev
    echo 'create database ci1' | hgsql ''


CREATING GRP TABLE FOR TRACK GROUPING 
    ssh hgwdev
    echo "create table grp (PRIMARY KEY(NAME)) select * from rn1.grp" \
      | hgsql ci1


STORING O+O SEQUENCE AND ASSEMBLY INFORMATION
    # Make symbolic links in /gbdb/ci1/nib to the real nibs.
    ssh hgwdev
    mkdir -p /gbdb/ci1/nib
    foreach f (/cluster/store5/squirt/ci1/nib/*.nib)
      ln -s $f /gbdb/ci1/nib
    end
    # Load /gbdb/ci1/nib paths into database 
    hgsql ci1  < ~kent/src/hg/lib/chromInfo.sql
    cd ~/ci1
    hgNibSeq -preMadeNib ci1 /gbdb/ci1/nib scaffolds/*.fa

    # make gcPercent table
    ssh hgwdev
    mkdir -p ~/ci1/bed/gcPercent
    cd ~/ci1/bed/gcPercent
    hgsql ci1  < ~/kent/src/hg/lib/gcPercent.sql
    hgGcPercent ci1 ../../nib

    # Load genbank entries
    cd /cluster/store5/genbank
    ./bin/gbDbLoadStep -initialLoad ci1
