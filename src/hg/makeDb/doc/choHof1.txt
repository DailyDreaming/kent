# for emacs: -*- mode: sh; -*-

# sloth ( Choloepus hoffmanni )
#########################################################################
# DOWNLOAD SEQUENCE (DONE braney 2008-10-07)
    ssh kkstore05
    mkdir /cluster/store12/choHof1
    ln -s /cluster/store12/choHof1 /cluster/data
    mkdir /cluster/data/choHof1/broad
    cd /cluster/data/choHof1/broad

    wget --timestamping \
ftp://ftp.broad.mit.edu/pub/assemblies/mammals/sloth/ChoHof1.0/assembly.agp \
ftp://ftp.broad.mit.edu/pub/assemblies/mammals/sloth/ChoHof1.0/assembly.bases.gz \
ftp://ftp.broad.mit.edu/pub/assemblies/mammals/sloth/ChoHof1.0/assembly.quals.gz 
    md5sum ass* > assembly.md5sum

    qaToQac assembly.quals.gz stdout | qacAgpLift assembly.agp stdin choHof1.qual.qac

   cut -f 1 assembly.agp | uniq -c | wc -l 
   # Number of scaffolds: 481259

#########################################################################
# Create .ra file and run makeGenomeDb.pl (DONE braney 2008-10-07)
    ssh kolossus
    cd /cluster/data/choHof1
cat << _EOF_ >choHof1.config.ra
# Config parameters for makeGenomeDb.pl:
db choHof1
clade mammal
genomeCladePriority 35
scientificName Choloepus hoffmanni
commonName Sloth
assemblyDate Jul. 2008
assemblyLabel Broad Institute choHof1 
orderKey 236.5
#mitoAcc AJ222767
mitoAcc none
fastaFiles /cluster/data/choHof1/broad/assembly.bases.gz
agpFiles /cluster/data/choHof1/broad/assembly.agp
qualFiles /cluster/data/choHof1/broad/choHof1.qual.qac
dbDbSpeciesDir sloth
_EOF_

    makeGenomeDb.pl -workhorse kolossus choHof1.config.ra > makeGenomeDb.out 2>&1 &

    cut -f 2 chrom.sizes | ave stdin
# Q1 1235.000000
# median 2269.000000
# Q3 6207.000000
# average 5109.364438
# min 250.000000
# max 197267.000000
# count 481259
# total 2458927620.000000
# standard deviation 6671.452585

#########################################################################
# REPEATMASKER (not done)
    ssh kkstore05
    screen # use a screen to manage this job
    mkdir /cluster/data/choHof1/bed/repeatMasker
    cd /cluster/data/choHof1/bed/repeatMasker
    doRepeatMasker.pl -buildDir=/cluster/data/choHof1/bed/repeatMasker \
        choHof1 > do.log 2>&1 &

    # Note: can run simpleRepeats simultaneously
    #### When done with RM:
    time nice -n +19 featureBits choHof1 rmsk > fb.choHof1.rmsk.txt 2>&1 &
# 734740693 bases of 2060445842 (35.659%) in intersection

    # RepeatMasker and lib version from do.log:
    #    Jun 13 2008 (open-3-2-5) version of RepeatMasker
    # CC   RELEASE 20080611;  


#########################################################################
# SIMPLE REPEATS TRF (not done)
    ssh kkstore05
    screen # use a screen to manage this job
    mkdir /cluster/data/choHof1/bed/simpleRepeat
    cd /cluster/data/choHof1/bed/simpleRepeat
    # 
    doSimpleRepeat.pl -buildDir=/cluster/data/choHof1/bed/simpleRepeat \
	choHof1 > do.log 2>&1 &

    #### When done
    featureBits choHof1 simpleRepeat
    # 32246798 bases of 2060445842 (1.565%) in intersection

    #	after RM run is done, add this mask:
    cd /cluster/data/choHof1
    twoBitMask choHof1.rmsk.2bit -add bed/simpleRepeat/trfMask.bed choHof1.2bit

    twoBitToFa choHof1.2bit stdout | faSize stdin

# 2458941592 bases (398495750 N's 2060445842 real 1327799854 upper 732645988
# lower) in 481260 sequences in 1 files
# Total size: mean 5109.4 sd 6671.4 min 600 (scaffold_481259) max 197267
# (scaffold_0) median 2269
# N count: mean 828.0 sd 1404.5
# U count: mean 2759.0 sd 4098.4
# L count: mean 1522.3 sd 1925.2
# %29.80 masked total, %35.56 masked real

    twoBitToFa choHof1.rmsk.2bit stdout | faSize stdin

# 2458941592 bases (398495750 N's 2060445842 real 1328190473 upper 732255369
# lower) in 481260 sequences in 1 files
# Total size: mean 5109.4 sd 6671.4 min 600 (scaffold_481259) max 197267
# (scaffold_0) median 2269
# N count: mean 828.0 sd 1404.5
# U count: mean 2759.8 sd 4099.5
# L count: mean 1521.5 sd 1924.3
# %29.78 masked total, %35.54 masked real

    # Link to it from /gbdb
    rm -f /gbdb/choHof1/choHof1.2bit
    ln -s /cluster/data/choHof1/choHof1.2bit /gbdb/choHof1/choHof1.2bit
