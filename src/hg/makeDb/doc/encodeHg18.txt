#!/bin/csh -f
exit

#############################################################################
# This is the make doc for hg18 ENCODE

#############################################################################
# Create encodeRegions table

    ssh hgwdev
    cd /cluster/data/encode
    mkdir convertHg18
    ln -s convertHg18 hg18
    ln -s convertHg17 hg17
    cd hg18
    hgsql hg17 -N -e "SELECT * FROM encodeRegions ORDER BY name" | \
        liftOver stdin /gbdb/hg17/liftOver/hg17ToHg18.over.chain.gz \
                encodeRegions.tab encodeRegions.unmapped
    hgLoadBed hg18 encodeRegions encodeRegions.bed
    cp encodeRegions.bed ~/browser/ENCODE/build35_regions.bed
    # cvs add, install in /usr/local/apache/htdocs/ENCODE

#############################################################################
# MSA alignments (kate)
#  Submittted by Elliott Margulies, 2007-05-11

    ssh kkstore03
    cd /cluster/data/encode/TBA
    mkdir -p APR-07/lab
    cd APR-07/lab
    wget -r -nv -nd -np ftp://kronos.nhgri.nih.gov/pub/outgoing/elliott/msa/APR-2007/apr_2007_tba_hg18.tar

    cd ..
    mkdir maf
cat > getMafs.csh << 'EOF'
    foreach f (lab/*/*.maf.gz)
        echo $f
        gunzip -c $f | \
            sed 's/^s human\./s hg18./' \
                        > maf/$f:t:r:r:e.maf
    end
'EOF'
    csh getMafs.csh >&! getMafs.log &

    ssh hgwdev
    cd /cluster/data/encode/TBA/APR-07/maf
    set gdir = /gbdb/hg18/encode/TBA/APR-07/maf
    mkdir -p $gdir
    rm -f $gdir/*.maf
    ln -s /cluster/data/encode/TBA/APR-07/maf/*.maf $gdir
    hgLoadMaf -pathPrefix=$gdir -WARN hg18 encodeTbaAlign >&! load.log
    cat *.maf | hgLoadMafSummary hg18 encodeTbaSummary stdin

<<<<<<< encodeHg18.txt

###########################################
# 
=======
##############################################################################
# Lifting rampage (Andy)
# 

bash
cd /cluster/data/encode/convertHg18
/cluster/data/encode/bin/scripts/listEncodeTables.csh hg17 > hg17.tables
wc -l hg17.tables
#554 hg17.tables (dang)

# start with easy beds i.e. the ones like "bed <num> ."

grep "bed.*\." hg17.tables > easyBeds.tables
grep -v "bed.*\." hg17.tables > remaining.tables
wc -l easyBeds.tables
#127 easyBeds.tables
mkdir easyBeds
for fields in 3 4 5 6 9 12; do 
    for table in `grep "bed $fields" easyBeds.tables | cut -f1`; do 
       /cluster/data/encode/bin/scripts/convertBedTable.csh hg17 hg18 \
         $table $fields >> easyBeds.script.log 
       mv $table.* easyBeds/
    done
done
# still got 4 like "bed ." 
egrep -v "bed (3|4|5|6|9|12)" easyBeds.tables
#encodeYaleChIPSTAT1HeLaBingRenSites     encodeChip      bed .
#encodeYaleChIPSTAT1HeLaMaskLess36mer36bpSite    encodeChip      bed .
#encodeYaleChIPSTAT1HeLaMaskLess50mer38bpSite    encodeChip      bed .
#encodeYaleChIPSTAT1HeLaMaskLess50mer50bpSite    encodeChip      bed .
# these are all bed 3
for table in `egrep -v "bed (3|4|5|6|9|12)" easyBeds.tables | cut -f1`; do
       /cluster/data/encode/bin/scripts/convertBedTable.csh hg17 hg18 \
         $table 3 >> easyBeds.script.log
       mv $table.* easyBeds/
done

# ok now there's ones like "bed <num> +"
wc -l remaining.tables
#427 remaining.tables
grep '\+' remaining.tables > plusBed.tables
grep -v '\+' remaining.tables > tmp; mv tmp remaining.tables 
wc -l remaining.tables plusBed.tables 
#  383 remaining.tables
#   44 plusBed.tables
#  427 total
mkdir plusBeds
for fields in 4 5 6 9 12; do
    for table in `grep "bed $fields" plusBed.tables | cut -f1`; do
       /cluster/data/encode/bin/scripts/convertBedTable.csh hg17 hg18 \
         $table $fields >> plusBeds.script.log
       mv $table.* plusBeds/
    done
done

# how about bedGraph ones?
grep bedGraph remaining.tables > bedGraph.tables
grep -v bedGraph remaining.tables > tmp; mv tmp remaining.tables 
wc -l bedGraph.tables remaining.tables 
#  186 bedGraph.tables
#  197 remaining.tables
#  383 total
mkdir bedGraph
for table in `cut -f1 bedGraph.tables`; do
       /cluster/data/encode/bin/scripts/convertBedTable.csh hg17 hg18 \
         $table 4 >> bedGraph.script.log
       mv $table.* bedGraph/
done

# 197 left!


######################################
# Continue lifting rampage (ting, 06-07-2007)
#

# Examining remaining.tables
# All GIS tables are bed 12, so lift these
		grep Gis remaining.tables > Gis.tables
		grep -v Gis remaining.tables > tmp; mv tmp remaining.tables
		wc -l Gis.tables remaining.tables
		#    7 Gis.tables
		#  190 remaining.tables
		#  197 total
		mkdir bedGis
		doGis.csh
		# 7 tables lifted.

# 190 remaining.

