# for emacs: -*- mode: sh; -*-

    # Trackify supplemental info from http://www.sciencemag.org/content/345/6202/1369/suppl/DC1
    # "Genomic surveillance elucidates Ebola virus origin and transmission during the 2014 outbreak"
    # Gire et al, Science 12 September 2014: vol. 345 no. 6202 pp. 1369-1372

    mkdir /hive/data/genomes/eboVir2/bed/gire
    cd /hive/data/genomes/eboVir2/bed/gire

    # They used KM034562.1 as the reference sequence.  Fortunately this has only 7 SNVs
    # and 2 bases missing at the end relative to our eboVir2 reference sequence (KJ660347.2).
    # BLAT them... (http://www.ncbi.nlm.nih.gov/nuccore/661348725?report=fasta)
    twoBitToFa ../../eboVir2.2bit -seq=KJ660347v2 KJ660347v2.fa
    blat KJ660347v2.fa KM034562.fa kjToKm.psl
    # OK, that just confirms that we don't need to do a liftOver; dig up locations of
    # differences from the browser, because for VCF we need the correct REF and ALT alleles
    # (and corresponding 0 and 1 genotypes).  In pgSNP format for custom track:
track name=KMDiffs type=pgSnp visibility=pack
KJ660347v2	1848	1849	T/C	2	0,0	0,0
KJ660347v2	6282	6283	C/T	2	0,0	0,0
KJ660347v2	9922	9923	C/T	2	0,0	0,0
KJ660347v2	11810	11811	C/T	2	0,0	0,0
KJ660347v2	13855	13856	A/G	2	0,0	0,0
KJ660347v2	15598	15599	A/G	2	0,0	0,0
KJ660347v2	15659	15660	T/C	2	0,0	0,0
    # Visually checked the custom track against BLAT diffs -- looks good.

    # Oh damn... they used KJ660347.1 but we need .2, likewise for 346 and 348.
    # I guess the script will have to update those too.  They also have "." for some bases.

    # File S1: Alignment and SNP calls used in this study.
    wget http://www.sciencemag.org/content/suppl/2014/08/27/science.1259657.DC1/1259657_file_s1.zip
    unzip 1259657_file_s1.zip
    cd snp
    wc -l *.vcf
#    63 SNP-2014.vcf
#  1311 SNP-ZEBOV.vcf
    ~/kent/src/hg/utils/automation/gireVcfToUcsc.pl SNP-2014.vcf > gire2014.vcf
    ~/kent/src/hg/utils/automation/gireVcfToUcsc.pl SNP-ZEBOV.vcf > gireZebov.vcf
    # Compress, index, put in /gbdb and load up...
    foreach f (gire*.vcf)
      bgzip $f
      tabix -p vcf $f.gz
    end
    mkdir /gbdb/eboVir2/gire
    ln -s `pwd`/gire*.vcf.gz{,.tbi} /gbdb/eboVir2/gire/
    hgBbiDbLink eboVir2 gire2014 /gbdb/eboVir2/gire/gire2014.vcf.gz
    hgBbiDbLink eboVir2 gireZebov /gbdb/eboVir2/gire/gireZebov.vcf.gz

    # Jim's request: make tracks with only missense mutations
    foreach t (2014 ZEBOV)
      grep ^# SNP-$t.vcf > SNP-$t-missense.vcf
      grep MISSENSE SNP-$t.vcf >> SNP-$t-missense.vcf
      set n = `echo $t | sed -e 's/ZEBOV/Zebov/'`
      set vcf = gire${n}Missense.vcf
      ~/kent/src/hg/utils/automation/gireVcfToUcsc.pl SNP-$t-missense.vcf > $vcf
      bgzip $vcf
      tabix -p vcf $vcf.gz
      ln -s `pwd`/$vcf.gz{,.tbi} /gbdb/eboVir2/gire/
      hgBbiDbLink eboVir2 $vcf:r /gbdb/eboVir2/gire/$vcf.gz
    end

#TODO
    # File S2: Phylogenetic trees created using MrBayes and RAxML.
    wget http://www.sciencemag.org/content/suppl/2014/08/27/science.1259657.DC1/1259657_file_s2.zip
    unzip 1259657_file_s2.zip

    # File S4: Intrahost variants for 78 Sierra Leone EVD patients. 
    wget http://www.sciencemag.org/content/suppl/2014/08/27/science.1259657.DC1/1259657_file_s4.zip
    unzip 1259657_file_s4.zip

    # Table S4: SNPs unique to the 2014 outbreak variant.
    wget http://www.sciencemag.org/content/suppl/2014/08/27/science.1259657.DC1/1259657_table_s4.zip
    unzip 1259657_table_s4.zip
    # Use a spreadsheet tool to convert .xslx to tab-sep text.

