#########################################################################
# Sorex unguiculatus -- Common Shrew
# Broad sorAra1 2X release

#########################################################################
# Download sequence (2006-03-05 kate)

    ssh kkstore05
    mkdir -p /cluster/store12/sorAra1
    ln -s /cluster/store12/sorAra1 /cluster/data/sorAra1 
    cd /cluster/data/sorAra1
    mkdir downloads
    cd downloads
    wget -r -nd ftp://ftp.broad.mit.edu/pub/assemblies/mammals/commonShrew/sorAra1

#########################################################################
# Create .ra file and run makeGenomeDb.pl
    ssh hgwdev
    cd /cluster/data/sorAra1
    cat << '_EOF_' >sorAra1.config.ra
# Config parameters for makeGenomeDb.pl:
db sorAra1
clade mammal
genomeCladePriority 36
scientificName Sorex araneus 
commonName Shrew
assemblyDate June 2006
assemblyLabel Broad Institute sorAra1 (Draft_v2)
orderKey 100
# search Entrez nucleotide for 'sorex araneus mitochondrion complete genome, use GI #'
# not found (only sorex unguiculatus)
mitoAcc none
fastaFiles /cluster/data/sorAra1/downloads/assembly.bases.gz
agpFiles /cluster/data/sorAra1/downloads/assembly.agp
qualFiles /cluster/data/sorAra1/downloads/scaffold.lifted.qac
dbDbSpeciesDir shrew
'_EOF_'

    makeGenomeDb.pl -verbose=2 -stop=seq sorAra1.config.ra >& makeGenomeDb.out &

    # Need dbDb entry for name lookup
    hgsql -e 'INSERT INTO dbDb (name, description, nibPath, organism, \
        defaultPos, active, orderKey, genome, scientificName, \
        htmlPath, hgNearOk, hgPbOk, sourceName) \
        VALUES("sorAra1", "June 2006", "/gbdb/sorAra1", "Shrew", \
        "", 0, 100, "Shrew", \
        "Sorex araneus", "", 0, 0, \
        "Broad Institute sorAra (Draft_v2)")' -h localhost hgcentraltest

################################################
## WINDOWMASKER (2006-03-04 kate)
    ssh kkstore05
    cd /cluster/data/sorAra1/bed/
    # note: only runs on kolossus, due to network connection to NCBI
    # requested Andy hardcode this.
    nice /cluster/bin/scripts/doWindowMasker.pl sorAra1 \
        -workhorse=kolossus >& wmRun.log &

    ln -s WindowMasker.2007-03-05 WMRun
    mv wmRun.log WMRun
    cd WMRun

    # upper-case n's left by WM (request to Andy to fix this)
    twoBitToFa sorAra1.wmsk.sdust.2bit stdout | tr n N | \
            faToTwoBit stdin /cluster/data/sorAra1/sorAra1.2bit

    # stats on masking
    cd /cluster/data/sorAra1
    twoBitToFa sorAra1.2bit stdout | nice faSize stdin >& faSize.log &
# 2936119008 bases (1103254311 N's 1832864697 real 1116732269 upper 716132428 lower) in 262057 sequences in 1 files
# Total size: mean 11204.1 sd 25927.2 min 203 (scaffold_107701) max 791662 (scaffold_254556) median 4789

    # 39.1% masked
    # Mouse and rat are ~43%, from RM.  TRF gives them an extra 2%, skip here

    mkdir -p /san/sanvol1/scratch/sorAra1
    cp -p sorAra1.2bit chrom.sizes /san/sanvol1/scratch/sorAra1
