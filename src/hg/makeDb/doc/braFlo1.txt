# for emacs: -*- mode: sh; -*-


# This file describes browser build for the Lancelet
# genome, Branchiostoma floridae, March 2006, v.1.0 from JGI
#
#       "$Id: braFlo1.txt,v 1.10 2008/04/18 23:50:22 hiram Exp $"
#

##########################################################################
### Fetch sequence       (DONE - 2007-03-26 - Hiram)
    ssh kkstore05
    mkdir /cluster/store12/braFlo1
    ln -s /cluster/store12/braFlo1 /cluster/data/braFlo1
    mkdir /cluster/data/braFlo1/downloads
    cd /cluster/data/braFlo1/downloads
    wget --timestamping \
'ftp://ftp.jgi-psf.org/pub/JGI_data/Branchiostoma_floridae/v1.0/Branchiostoma.fasta.gz'
    wget --timestamping \
'ftp://ftp.jgi-psf.org/pub/JGI_data/Branchiostoma_floridae/v1.0/proteins.Brafl1.fasta.gz'
    wget --timestamping \
'ftp://ftp.jgi-psf.org/pub/JGI_data/Branchiostoma_floridae/v1.0/transcripts.Brafl1.fasta.gz'
    gunzip Branchiostoma.fasta.gz
    scaffoldFaToAgp Branchiostoma.fasta

##########################################################################
## Set up initial database (DONE - 2007-03-26 - Hiram)
    cd /cluster/data/braFlo1
    cat << '_EOF_' > braFlo1.config.ra
# Config parameters for makeGenomeDb.pl:
db braFlo1
clade deuterostome
genomeCladePriority 20
scientificName Branchiostoma floridae
commonName Lancelet
assemblyDate Mar. 2006
assemblyLabel JGI v.1.0 (March 2006)
orderKey 799
mitoAcc 5881414
fastaFiles /cluster/data/braFlo1/downloads/Branchiostoma.fasta
agpFiles /cluster/data/braFlo1/downloads/Branchiostoma.agp
# qualFiles none
dbDbSpeciesDir lancelet
'_EOF_'
    time nice -n +19 makeGenomeDb.pl braFlo1.config.ra > makeGenomeDb.out 2>&1

    hgsql -e 'INSERT INTO chrM_gold
(bin, chrom, chromStart, chromEnd, ix, type, frag, fragStart, fragEnd, strand)
VALUES (585, "chrM", 0, 15083, 1, "F", "NC_000834.1", 0, 15083, "+");' braFlo1

    ## done with this sequence
    cd downloads
    gzip Branchiostoma.fasta

##########################################################################
## RepeatMasker (DONE - 2007-03-26 - Hiram)
    ssh kkstore05
    mkdir /cluster/data/braFlo1/bed/RepeatMasker
    cd /cluster/data/braFlo1/bed/RepeatMasker
    time nice -n +10 doRepeatMasker.pl braFlo1 \
	-buildDir=/cluster/data/braFlo1/bed/RepeatMasker > do.log 2>&1 &
    # about 11 minutes
    cd /cluster/data/braFlo1
    twoBitToFa braFlo1.rmsk.2bit stdout | faSize -showPercent stdin
    #	926386587 bases (95184565 N's 831202022 real
    #	806238402 upper 24963620 lower) in 2 sequences in 1 files
    #	twoBitToFa braFlo1.rmsk.2bit stdout | faSize -showPercent stdin
    #	%2.69 masked total, %3.00 masked real

#########################################################################
# SIMPLE REPEATS (TRF) (DONE 2007-01-22 - Hiram)
    ssh kolossus
    mkdir /cluster/data/braFlo1/bed/simpleRepeat
    cd /cluster/data/braFlo1/bed/simpleRepeat
    for C in chrM chrUn
do
    mkdir /scratch/tmp/braFlo1.trf
    twoBitToFa -seq="${C}" ../../braFlo1.unmasked.2bit \
	/scratch/tmp/braFlo1.trf/${C}.fa
    time nice -n 19 trfBig -trf=/cluster/bin/i386/trf \
	/scratch/tmp/braFlo1.trf/${C}.fa /dev/null \
	-bedAt=${C}.bed -tempDir=/scratch/tmp/braFlo1.trf > ${C}.log 2>&1
    rm -fr /scratch/tmp/braFlo1.trf
    echo ${C} done
done
    #	real    187m42.772s
    #	no repeats found on chrM
    # Make a filtered version for sequence masking:
    awk '{if ($5 <= 12) print;}' chrUn.bed > trfMask.bed

  # Load unfiltered repeats into the database:
    ssh hgwdev
    hgLoadBed braFlo1 simpleRepeat \
      /cluster/data/braFlo1/bed/simpleRepeat/chrUn.bed \
      -sqlTable=$HOME/kent/src/hg/lib/simpleRepeat.sql

################################################
## WINDOWMASKER (DONE - 2007-03-26 - Hiram)
    ssh kkstore05
    mkdir /cluster/data/braFlo1/bed/WindowMasker
    cd /cluster/data/braFlo1/bed/WindowMasker
    time nice -n +19 ~/kent/src/hg/utils/automation/doWindowMasker.pl braFlo1 \
      -buildDir=/cluster/data/braFlo1/bed/WindowMasker \
	-workhorse=kolossus > wmRun.log 2>&1 &
    #	real    82m55.387s

    # Masking statistics
    twoBitToFa braFlo1.wmsk.sdust.2bit stdout | faSize stdin
    #	926386587 bases (95184565 N's 831202022 real
    #	611909619 upper 219292403 lower) in 2 sequences in 1 files
    #	%23.67 masked total, %26.38 masked real

    ssh hgwdev
    time nice -n +19 \
	hgLoadBed -strict braFlo1 windowmaskerSdust windowmasker.sdust.bed.gz
    #	Loaded 4263263 elements of size 3

    ## Add trfMask.bed to this wmsk.sdust.2bit file
    cd /cluster/data/braFlo1
    cat bed/simpleRepeat/trfMask.bed \
	| twoBitMask -add -type=.bed bed/WindowMasker/braFlo1.wmsk.sdust.2bit \
	stdin braFlo1.wmTrf.2bit
    twoBitToFa braFlo1.wmTrf.2bit stdout | faSize stdin
    #	926386587 bases (95184565 N's 831202022 real
    #	611655540 upper 219546482 lower) in 2 sequences in 1 files
    #	%23.70 masked total, %26.41 masked real
    ln -s braFlo1.wmTrf.2bit braFlo1.2bit
    ln -s /cluster/data/braFlo1/braFlo1.2bit /gbdb/braFlo1/braFlo1.2bit

#########################################################################
## Create masked scaffolds-only 2bit file (DONE - 2007-03-26 - Hiram)
    ssh kkstore05
    mkdir /cluster/data/braFlo1/scaffolds
    cp -p /cluster/data/oryLat1/jkStuff/lft2BitToFa.pl \
	/cluster/data/braFlo1/jkStuff
    cp -p /cluster/data/oryLat1/jkStuff/agpToLift.pl \
	/cluster/data/braFlo1/jkStuff
    cd /cluster/data/braFlo1/scaffolds
    ln -s ../Un/chrUn.agp .
    ../jkStiff/agpToLift.pl chrUn.agp > braFlo1.lift
    ../jkStuff/lft2BitToFa.pl ../braFlo1.2bit braFlo1.lift \
	> chrUn.scaffolds.fa
    twoBitToFa ../braFlo1.2bit chrM.fa
    faToTwoBit chrUn.scaffolds.fa chrM.fa braFlo1UnScaffolds.2bit
    twoBitInfo braFlo1UnScaffolds.2bit stdout | sort -k2nr \
	> braFlo1UnScaffolds.sizes
    cp -p braFlo1UnScaffolds.sizes braFlo1UnScaffolds.2bit braFlo1.lift \
	 /san/sanvol1/scratch/braFlo1

#########################################################################
## Reload rmsk to take care of empty chrM (DONE - 2007-03-26 - Hiram)
    ssh hgwdev
    cd /cluster/data/braFlo1/bed/RepeatMasker
    hgLoadOut -table=rmsk -nosplit braFlo1 braFlo1.fa.out
    hgsql -e "drop table chrUn_rmsk;" braFlo1
    #	before:
    featureBits braFlo1 rmsk
    #	24973684 bases of 923355587 (2.705%) in intersection
    #	after:
    featureBits braFlo1 rmsk
    #	24973684 bases of 923355587 (2.705%) in intersection
 
#########################################################################
## BLASTZ HUMAN HG18 (DONE - 2007-03-26 - Hiram)
    # measurement on hg18
    ssh kkstore02
    cd /cluster/data/hg18/bed/blastz.braFlo1.2007-03-26
    cat fb.hg18.chainBraFlo1Link.txt
    #	26455595 bases of 2881515245 (0.918%) in intersection

    # and now the swap
    mkdir /cluster/data/braFlo1/bed/blastz.hg18.swap
    cd /cluster/data/braFlo1/bed/blastz.hg18.swap
    time doBlastzChainNet.pl -chainMinScore=2000 -chainLinearGap=loose \
	/cluster/data/hg18/bed/blastz.braFlo1.2007-03-26/DEF \
	-tRepeats=windowmaskerSdust -qRepeats=windowmaskerSdust \
	-bigClusterHub=pk -verbose=2 \
	-swap > swap.log 2>&1 &
    #	real    83m46.258s
    cat fb.braFlo1.chainHg18Link.txt
    #	30912893 bases of 923355587 (3.348%) in intersection

    #	create reciprocal best chains/nets for 5-way maf alignments
    ssh hgwdev
    cd /cluster/data/braFlo1/bed/blastz.hg18.swap
    time nice -n +19 /cluster/bin/scripts/doRecipBest.pl braFlo1 hg18 \
	> rbest.log 2>&1 &
    #	real    35m1.307s
    #	This did not work right.  Something went haywire somewhere:
# Error: braFlo1 rbest net coverage 14190116 != hg18 14270477

#########################################################################
# MAKE 11.OOC FILE FOR BLAT (DONE - 2007-01-18 - Hiram)
    # Use -repMatch=328 (based on size -- for human we use 1024, and 
    # lancelet size is ~32% of human judging by gapless braFlo1 vs. hg18 
    # genome sizes from featureBits.
    ssh kolossus
    cd /cluster/data/braFlo1
    blat braFlo1.2bit /dev/null /dev/null -tileSize=11 \
      -makeOoc=jkStuff/11.ooc -repMatch=328
    #	Wrote 9536 overused 11-mers to jkStuff/11.ooc
    cp -p jkStuff/11.ooc /san/sanvol1/scratch/braFlo1

#########################################################################
# GENBANK AUTO UPDATE (DONE - 2007-03-26,27 - Hiram)
    # align with latest genbank process.
    ssh hgwdev
    cd ~/kent/src/hg/makeDb/genbank
    cvsup
    # edit etc/genbank.conf to add braFlo1 just after gasAcu1

# braFlo1 (Branchiostoma floridae - Lancelet)
braFlo1.serverGenome = /cluster/data/braFlo1/braFlo1.2bit
braFlo1.clusterGenome = /san/sanvol1/scratch/braFlo1/braFlo1.2bit
braFlo1.refseq.mrna.native.pslCDnaFilter  = ${ordered.refseq.mrna.native.pslCDnaFilter}
braFlo1.refseq.mrna.xeno.pslCDnaFilter    = ${ordered.refseq.mrna.xeno.pslCDnaFilter}
braFlo1.genbank.mrna.native.pslCDnaFilter = ${ordered.genbank.mrna.native.pslCDnaFilter}
braFlo1.genbank.mrna.xeno.pslCDnaFilter   = ${ordered.genbank.mrna.xeno.pslCDnaFilter}
braFlo1.genbank.est.native.pslCDnaFilter  = ${ordered.genbank.est.native.pslCDnaFilter}
braFlo1.ooc = /san/sanvol1/scratch/braFlo1/11.ooc
braFlo1.lift = /cluster/data/braFlo1/jkStuff/liftAll.lft
braFlo1.refseq.mrna.native.load = no
braFlo1.refseq.mrna.xeno.load = yes
braFlo1.genbank.mrna.xeno.load = yes
braFlo1.genbank.est.native.load = yes
braFlo1.downloadDir = braFlo1
braFlo1.perChromTables = no

    cvs ci -m "Added braFlo1." etc/genbank.conf
    # update /cluster/data/genbank/:
    make etc-update

    # Edit src/lib/gbGenome.c to add new species.
    cvs ci -m "Added Branchiostoma floridae (lancelet)." src/lib/gbGenome.c
    make install-server

    ssh kkstore05
    cd /cluster/data/genbank
    time nice -n +19 bin/gbAlignStep -initial braFlo1 &
    #	logFile: var/build/logs/2007.03.26-21:58:34.braFlo1.initalign.log
    #	real    230m8.123s

    # load database when finished
    ssh hgwdev
    cd /cluster/data/genbank
    time nice -n +19 ./bin/gbDbLoadStep -drop -initialLoad braFlo1
    #	logFile: var/dbload/hgwdev/logs/2007.03.27-07:52:23.dbload.log
    #	real    6m57.557s
    ## re-load to get the est track after adding that to the .conf file
    #	var/dbload/hgwdev/logs/2007.03.29-17:09:35.dbload.log
    #	real    19m2.168s

    # enable daily alignment and update of hgwdev
    cd ~/kent/src/hg/makeDb/genbank
    cvsup
    # add braFlo1 to:
        etc/align.dbs
        etc/hgwdev.dbs
    cvs ci -m "Added braFlo1 - Branchiostoma floridae (lancelet)" \
	etc/align.dbs etc/hgwdev.dbs
    make etc-update

############################################################################
## Adding a photograph (DONE - 2007-03-28 - Hiram)
## From Hector Escriva: hector.escriva@obs-banyuls.fr
# Dr. Clawson
# All the european teams working with amphioxus have changed to B.
# lanceolatum species and none of us is still working with B. floridae. We
# are able here to induce spawnings everyday (on B. lanceolatum) and this
# is impossible with the american species which limits very much the
# amount of experiments that one can perform. So I have pictures of B.
# lanceolatum, which is morphologically the same as floridae (even me I
# cannot distinghish them). So I send you here a picture of a B.
# lanceolatum juvenile in which we clearly see the main morphological
# aspects of this animal. You should however write the correct name of the
# species in order to be serious.
# I would also ask you to write in "Photo courtesy of", the name of my
# technicien who did the picture and myself. Michael Fuentes and Hector Escriva.
# Let me know if you agree with this picture.
# Sincerely Hector Escriva
    mkdir /cluster/data/braFlo1/photograph
    cd /cluster/data/braFlo1/photograph
    convert -sharpen 0 -normalize -geometry 350x200 \
	PostmetamorphicLarvae.jpg Branchiostoma_lanceolatum.jpg

############################################################################
#  BLATSERVERS ENTRY (DONE - 2007-04-04 - Hiram)
#	After getting a blat server assigned by the Blat Server Gods,
    ssh hgwdev

    hgsql -e 'INSERT INTO blatServers (db, host, port, isTrans, canPcr) \
	VALUES ("braFlo1", "blat11", "17784", "1", "0"); \
	INSERT INTO blatServers (db, host, port, isTrans, canPcr) \
	VALUES ("braFlo1", "blat11", "17785", "0", "1");' \
	    hgcentraltest
    #	test it with some sequence

############################################################################
## Default position set at IFG-1 (DONE - 2007-04-09 - Hiram)
    ssh hgwdev
    hgsql -e 'update dbDb set defaultPos="chrUn:619013791-619054719"
	where name="braFlo1";' hgcentraltest

############################################################################
#  BLASTZ petMar1 Lamprey (WORKING - 2008-04-11 - Hiram)
    ssh kkstore05
    screen	# use a screen to control this multi-day job
    mkdir /cluster/data/braFlo1/bed/blastzPetMar1.2008-04-11
    cd /cluster/data/braFlo1/bed/blastzPetMar1.2008-04-11

    cat << '_EOF_' > DEF
# Lancelet vs Lamprey

BLASTZ_H=2000
BLASTZ_Y=3400
BLASTZ_L=6000
BLASTZ_K=2200
BLASTZ_Q=/cluster/data/blastz/HoxD55.q

# TARGET: Lancelet braFlo1 - largest chunk big enough for largest scaffold
#       Largest scaffold 7,200,735 - 3032 scaffolds + chrM
SEQ1_DIR=/san/sanvol1/scratch/braFlo1/braFlo1.2bit
SEQ1_LEN=/san/sanvol1/scratch/braFlo1/chrom.sizes
SEQ1_CTGDIR=/san/sanvol1/scratch/braFlo1/braFlo1UnScaffolds.2bit
SEQ1_CTGLEN=/san/sanvol1/scratch/braFlo1/braFlo1UnScaffolds.sizes
SEQ1_LIFT=/san/sanvol1/scratch/braFlo1/braFlo1.lift
SEQ1_CHUNK=10000000
SEQ1_LIMIT=50
SEQ1_LAP=10000

# QUERY: Lamprey petMar1
SEQ2_DIR=/scratch/data/petMar1/petMar1.2bit
SEQ2_LEN=/cluster/data/petMar1/chrom.sizes
SEQ2_CHUNK=20000000
SEQ2_LIMIT=200
SEQ2_LAP=0

BASE=/cluster/data/braFlo1/bed/blastzPetMar1.2008-04-11
TMPDIR=/scratch/tmp
'_EOF_'
    # << happy emacs

    time nice -n +19 doBlastzChainNet.pl \
	/cluster/data/braFlo1/bed/blastzPetMar1.2008-04-11/DEF \
	-chainMinScore=5000 -chainLinearGap=loose \
	-tRepeats=windowmaskerSdust -qRepeats=windowmaskerSdust \
	-bigClusterHub=kk -verbose=2 > do.log 2>&1 &
# Completed: 78590 of 78590 jobs
# CPU time in finished jobs:   10056466s  167607.76m  2793.46h  116.39d  0.319 y
# IO & Wait Time:               6633099s  110551.65m  1842.53h   76.77d  0.210 y
# Average job time:                 212s       3.54m     0.06h    0.00d
# Longest finished job:            4572s      76.20m     1.27h    0.05d
# Submission to last job:        107694s    1794.90m    29.91h    1.25d
    #	continuing after various interruptions and finished the batch manually
    time nice -n +19 doBlastzChainNet.pl \
	/cluster/data/braFlo1/bed/blastzPetMar1.2008-04-11/DEF \
	-chainMinScore=5000 -chainLinearGap=loose \
	-tRepeats=windowmaskerSdust -qRepeats=windowmaskerSdust \
	-continue=cat -bigClusterHub=kk -verbose=2 > cat.log 2>&1 &
    #	real    12m43.792s
    cat fb.braFlo1.chainPetMar1Link.txt
    #	27418217 bases of 923355587 (2.969%) in intersection

    #	create reciprocal best chains/nets for 5-way maf alignments
    ssh hgwdev
    cd /cluster/data/braFlo1/bed/blastzPetMar1.2008-04-11
    time nice -n +19 /cluster/bin/scripts/doRecipBest.pl braFlo1 petMar1 \
	> rbest.log 2>&1 &
    #	real    30m11.990s

    #	and the swap
    mkdir /cluster/data/petMar1/bed/blastz.braFlo1.swap
    cd /cluster/data/petMar1/bed/blastz.braFlo1.swap
    time nice -n +19 doBlastzChainNet.pl \
	/cluster/data/braFlo1/bed/blastzPetMar1.2008-04-11/DEF \
	-chainMinScore=5000 -chainLinearGap=loose \
	-tRepeats=windowmaskerSdust -qRepeats=windowmaskerSdust \
	-swap -bigClusterHub=kk -verbose=2 > swap.log 2>&1 &
    #	real    194m53.514s
    cat fb.petMar1.chainBraFlo1Link.txt
    #	27373264 bases of 831696438 (3.291%) in intersection

##########################################################################
## BLASTZ Chicken GalGal3 swap (DONE - 2008-04-16 - Hiram)
    #	the original
    ssh kkstore03
    cd /cluster/data/galGal3/bed/blastzBraFlo1.2008-04-15
    cat fb.galGal3.chainBraFlo1Link.txt
    #	19795687 bases of 1042591351 (1.899%) in intersection

    #	and the swap
    mkdir /cluster/data/braFlo1/bed/blastz.galGal3.swap
    cd /cluster/data/braFlo1/bed/blastz.galGal3.swap
    time nice -n +19 doBlastzChainNet.pl \
	/cluster/data/galGal3/bed/blastzBraFlo1.2008-04-15/DEF \
	-chainMinScore=5000 -chainLinearGap=loose \
	-tRepeats=windowmaskerSdust -qRepeats=windowmaskerSdust \
	-swap -bigClusterHub=pk -verbose=2 > swap.log 2>&1 &
    #	real    4m45.054s
    cat fb.braFlo1.chainGalGal3Link.txt
    #	30287175 bases of 923355587 (3.280%) in intersection

    #	create reciprocal best chains/nets for 5-way maf alignments
    ssh hgwdev
    cd /cluster/data/braFlo1/bed/blastz.galGal3.swap
    time nice -n +19 /cluster/bin/scripts/doRecipBest.pl braFlo1 galGal3 \
	> rbest.log 2>&1 &
    #	real    24m30.834s

###########################################################################
## BLASTZ Mouse mm9 swap (DONE - 2008-04-17 - Hiram)
    #	the original
    ssh kkstore06
    cd /cluster/data/mm9/bed/blastzBraFlo1.2008-04-14
    cat fb.mm9.chainBraFlo1Link.txt
    #	26725980 bases of 2620346127 (1.020%) in intersection

    #	That is OK, now for the swap:
    mkdir /cluster/data/braFlo1/bed/blastz.mm9.swap
    cd /cluster/data/braFlo1/bed/blastz.mm9.swap
    time doBlastzChainNet.pl -verbose=2 -swap \
	/cluster/data/mm9/bed/blastzBraFlo1.2008-04-14/DEF \
	-chainMinScore=5000 -chainLinearGap=loose \
	-qRepeats=windowmaskerSdust -bigClusterHub=kk > swap.log 2>&1 &
    #	real    12m23.402s
    cat  fb.braFlo1.chainMm9Link.txt
    #	31517169 bases of 923355587 (3.413%) in intersection

    #	create reciprocal best chains/nets for 5-way maf alignments
    ssh hgwdev
    cd /cluster/data/braFlo1/bed/blastz.mm9.swap
    time nice -n +19 /cluster/bin/scripts/doRecipBest.pl braFlo1 mm9 \
	> rbest.log 2>&1 &
    #	real    35m15.178s

#############################################################################
## 5-Way Multiz (WORKING - 2008-04-17 - Hiram)
##
    ssh hgwdev
    mkdir /cluster/data/braFlo1/bed/multiz5way
    cd /cluster/data/braFlo1/bed/multiz5way
    #	take the 6-way tree from mm9 and eliminate genomes not in
    #	this alignment.  Manually add in petMar1 and braFlo1
    #	arbitrarily somewhere outside of the fishes
    #	rearrange to get braFlo1 on the top of the graph
    #	paste this tree into the on-line phyloGif tool:
    #	http://genome.ucsc.edu/cgi-bin/phyloGif
    #	to create the image for the tree diagram

    #	select the 5 organisms from the 6-way on Lamprey petMar1
    /cluster/bin/phast/tree_doctor \
	--prune-all-but \
Human_hg18,Mouse_mm9,Chicken_galGal3,Lamprey_petMar1,Lanclet_braFlo1 \
	/cluster/data/petMar1/bed/multiz6way/petMar1.6-way.nh \
	> 5-way.fullNames.nh

    #	looks something like this:
    ((Lamprey_petMar1:1.600000,(Chicken_galGal3:0.488824,
      (Mouse_mm9:0.325818,Human_hg18:0.126901):0.470757):0.725954):0.400000,
	Lanclet_braFlo1:2.000000);

    #	rearrange to get Lanclet at the top, this leaves us with:
    cat << '_EOF_' > braFlo1.5-way.nh
    (Lanclet_braFlo1:2.0,(Lamprey_petMar1:1.600000,(Chicken_galGal3:0.488824,
      (Mouse_mm9:0.325818,Human_hg18:0.126901):0.470757):0.725954):0.400000);
'_EOF_'
    #	<< happy emacs

    #	create a species list from that file:
    sed -e 's/[()]//g; s/ /\n/g; s/,/\n/g' braFlo1.5-way.nh \
        | sed -e "s/[ \t]*//g; /^[ \t]$/d; /^$/d" | sort -u \
        | sed -e "s/.*_//; s/:.*//" | sort > species.list
    #	verify that has 5 db names in it
    # create a stripped down nh file for use in autoMZ run
    echo \
`sed 's/[a-zA-Z0-9]*_//g; s/:[012].[0-9]*//g; s/[,;]/ /g' braFlo1.5-way.nh \
	| sed -e "s/  / /g"` > tree.5.nh
    #	that looks like, as a single line:
# (braFlo1 (petMar1 (galGal3 (mm9 hg18))))

    # verify all blastz's exists
    cat << '_EOF_' > listMafs.csh
#!/bin/csh -fe
cd /cluster/data/braFlo1/bed/multiz5way
foreach db (`grep -v braFlo1 species.list`)
    set bdir = /cluster/data/braFlo1/bed/blastz.$db
    if (-e $bdir/mafRBestNet/chrUn.maf.gz) then
	echo "$db mafRBestNet"
    else if (-e $bdir/mafSynNet/chrUn.maf.gz) then
	echo "$db mafSynNet"
    else if (-e $bdir/mafNet/chrUn.maf.gz) then
	echo "$db mafNet"
    else
	echo "$db mafs not found"
    endif
end
'_EOF_'
    # << happy emacs
    chmod +x ./listMafs.csh
    #	see what it says, these should all be mafRBestNet
    ./listMafs.csh
# canFam2 mafRBestNet
# hg18 mafRBestNet
# mm9 mafRBestNet
# monDom4 mafNet
# ornAna1 mafNet
# panTro2 mafRBestNet
# ponAbe2 mafRBestNet
# rheMac2 mafRBestNet


    /cluster/bin/phast/all_dists braFlo1.5-way.nh > 5way.distances.txt
    grep -i caljac 5way.distances.txt | sort -k3,3n
Marmoset_calJac1        Human_hg18      0.138447
Marmoset_calJac1        Rhesus_rheMac2  0.138473
Marmoset_calJac1        Orangutan_ponAbe2       0.139537
Marmoset_calJac1        Chimp_panTro2   0.140242
Marmoset_calJac1        Dog_canFam2     0.336180
Marmoset_calJac1        Mouse_mm9       0.454272
Marmoset_calJac1        Opossum_monDom4 0.712488
Marmoset_calJac1        Platypus_ornAna1        0.968524

    #	use the calculated
    #	distances in the table below to order the organisms and check
    #	the button order on the browser.  Zebrafish ends up before
    #	tetraodon and fugu on the browser despite its distance.
    #	And if you can fill in the table below entirely, you have
    #	succeeded in finishing all the alignments required.
    #
#                         featureBits chainLink measures
#                                       chainCalJac1Link   chain   linearGap
#    distance                     on CalJac1    on other   minScore
#  1  0.138447 Human_hg18         (% 82.846)   (% 78.351)   3000     medium
#  2  0.138473 Rhesus_rheMac2     (% 74.810)   (% 77.648)   3000     medium
#  3  0.139537 Orangutan_ponAbe2  (% 76.925)   (% 74.694)   3000     medium
#  4  0.140242 Chimp_panTro2      (% 77.296)   (% 76.308)   3000     medium
#  5  0.336180 Dog_canFam2        (% 57.429)   (% 49.549)   3000     medium
#  6  0.454272 Mouse_mm9          (% 30.302)   (% 32.971)   3000     medium
#  6  0.712488 Opossum_monDom4    (% 13.357)   (% 11.050)   5000     loose
#  7  0.968524 Platypus_ornAna1   (%  7.221)   (% 10.619)   5000     loose

#########################################################################
