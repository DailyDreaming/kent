#!/bin/awk -f
#ensGeneToGenePred - converts a mysql dump of ensembl exons to an extended genePred file. 
#if the gene is single exon, set to frame to 0 to override bad data from ensembl
BEGIN {OFS="\t";pname="first"}
pname==$11 && $9 != "." {
        eStart=eStart","$5; 
        eEnd=eEnd","$6; 
        cnt=cnt+1; 
        txEnd=$6; 
        frames=frames","$9
}
pname==$11 && $9 == "." {
        eStart=eStart","$5; 
        eEnd=eEnd","$6; 
        cnt=cnt+1; 
        txEnd=$6; 
        frames=frames",-1"
}
pname!=$11 && pname != "first" && cnt == 1{
       frames = "0";
}
pname!=$11 && pname != "first" {
        print pname, pChr, strand, txStart, txEnd, cdsStart, cdsEnd, cnt, eStart",", eEnd",", 0, name2, "cmpl", "cmpl", frames","; 
}
pname!=$11 && $9 != "." {
        txStart=$5; 
        txEnd=$6;
        pname=$11;
        pChr=$1;
        cdsStart=$3; 
        cdsEnd=$4; 
        eStart=$5; 
        eEnd=$6; 
        name2=$10; 
        frames=$9; 
        cnt=1; 
        strand=$8
}
pname!=$11 && $9 == "." {
        txStart=$5; 
        txEnd=$6;
        pname=$11;
        pChr=$1;
        cdsStart=$3; 
        cdsEnd=$4; 
        eStart=$5; 
        eEnd=$6; 
        name2=$10; 
        frames="-1"; 
        cnt=1; 
        strand=$8
}
END {
        print pname, pChr, strand, txStart, txEnd, cdsStart, cdsEnd, cnt, eStart",", eEnd",", 0, name2, "cmpl", "cmpl", frames","; 
}
