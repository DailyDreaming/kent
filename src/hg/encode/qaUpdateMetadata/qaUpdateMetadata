#!/hive/groups/encode/dcc/bin/python
import sys, os, re, argparse, subprocess, math
from ucscgenomics import ra, track

def main():
	parser = argparse.ArgumentParser(
		prog='qaUpdateMetadata',
		description='Update a the beta metaDb with selected items from the corresponding alpha metaDb object',
		epilog='example: qaUpdateMetadata hg19 wgEncodeUwDnaseSeq md5sum objType cell treatment'
		)
	parser.add_argument('-t', '--trackPath', help='Overrides the default track path ~/kent/src/hg/makeDb/trackDb/')
	parser.add_argument('database', help='The database, typically hg19 or mm9')
	parser.add_argument('composite', help='The composite name, wgEncodeCshlLongRnaSeq for instance')
	parser.add_argument('vars', metavar='VARS', type=str, nargs='+', help='The list of metadata variables to update from alpha to beta')

	if len(sys.argv) <= 1:
		parser.print_help()
	args = parser.parse_args(sys.argv[1:])
	vars = args.vars
	
	c = track.CompositeTrack(args.database, args.composite)
	newMdb = c.alphaMetaDb
	oldMdb = c.betaMetaDb
	
	changeDict = dict()
	for i in vars:
		(oldMdb, localChange) = oldMdb.updateDiffFilter(i, newMdb)
		for j in localChange:
			if j in changeDict:
				changeDict[j].append(localChange[j])
			else:
				changeDict[j] = list()
				changeDict[j] = localChange[j]
	for i in changeDict:
		print i
		for j in changeDict[i]:
			print "\t%s" % j
	
		
	
if __name__ == '__main__':
	main()
