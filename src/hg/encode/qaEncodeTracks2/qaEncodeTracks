#!/hive/groups/encode/dcc/bin/python
import sys, os, re, argparse, subprocess
from ucscgenomics import qa

def main():

	""" Run all the checks, print output"""

	parser = argparse.ArgumentParser(
        prog='qaChecks',
        formatter_class=argparse.RawDescriptionHelpFormatter,
        description='A series of checks for QA',
        epilog=
    """Examples:

qaChecks hg19 tableList
qaChecks hg19 tableList /path/to/trackDb.ra
qaChecks hg19 tableList ~/kent/src/hg/makeDb/trackDb/human/hg19/wgEncodeSydhTfbs.new.ra

    """
        )
	parser.add_argument('database', help='The database, typically hg19 or mm9')
	parser.add_argument('tableList', help='The file containing a list of tables')
	parser.add_argument('trackDb', help='The trackDb file to check')

	if len(sys.argv) == 1:
		parser.print_help()
		return

	args = parser.parse_args(sys.argv[1:])

	f = open(args.tableList, "r")
	lines = f.readlines()
	tables = set()
	for i in lines:
		tables.add(i.rstrip())

	output = []

	(tableDescOutput, noDescription) = checkTableDescriptions(args.database, tables)
	output.extend(tableDescOutput)

	(tableIndexOut, missingIndex) = checkTableIndex(args.database, tables)
	output.extend(tableIndexOut)

	(tableNameOut, badTableNames) = checkTableName(tables)
	output.extend(tableNameOut)

	(labelOut, badLabels) = checkLabels(args.trackDb)
	output.extend(labelOut)

	(coordsOut, badCoords) = checkTableCoords(args.database, tables)
	output.extend(coordsOut)

	(posOut, badPos) = positionalTblCheck(args.database, tables)
	output.extend(posOut)

	(countChromOut, tableCounts) = countPerChrom(args.database, tables)
	output.extend(countChromOut)

	for i in output:
		print i
	

if __name__ == "__main__":
	main()

